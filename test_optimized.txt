
> mediaplayer-app@1.0.5 pretest
> npm rebuild better-sqlite3

rebuilt dependencies successfully

> mediaplayer-app@1.0.5 test
> vitest run


[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90m/app[39m

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould handle synchronous spawn errors
[22m[39m[vlc-player] Error launching VLC: Error: Spawn failed
    at [90m/app/[39mtests/main/vlc.test.ts:298:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/core/vlc-player.ts:46:21
    at new Promise (<anonymous>)
    at openMediaInVlc [90m(/app/[39msrc/core/vlc-player.ts:43:10[90m)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:25:20
    at [90m/app/[39mtests/main/vlc.test.ts:301:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/vlc.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1948[2mms[22m[39m
     [33m[2mâœ“[22m[39m should be registered [33m 404[2mms[22m[39m
     [33m[2mâœ“[22m[39m should succeed if VLC is found on Windows [33m 308[2mms[22m[39m
     [33m[2mâœ“[22m[39m should attempt to spawn "vlc" on Linux [33m 305[2mms[22m[39m
     [33m[2mâœ“[22m[39m should use standard path on macOS if it exists [33m 304[2mms[22m[39m
     [33m[2mâœ“[22m[39m should fallback to "vlc" on macOS if standard path does not exist [33m 302[2mms[22m[39m
     [33m[2mâœ“[22m[39m should attach error listener to child process [33m 303[2mms[22m[39m
[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[Security] Access denied to file outside media directories: (resolved from /etc/passwd)

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny path traversal attempts
[22m[39m[Security] Access denied to file outside media directories: (resolved from /etc/passwd)

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny symlink traversal attacks
[22m[39m[Security] Access denied to file outside media directories: (resolved from /allowed/media/secret_link)

 [32mâœ“[39m tests/main/security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2123[2mms[22m[39m
     [33m[2mâœ“[22m[39m should allow access to files within allowed media directories [33m 2090[2mms[22m[39m
[90mstdout[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould return a stream
[22m[39m[GoogleDrive] Stream started for fileId

[90mstdout[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould use Range header if start/end provided
[22m[39m[GoogleDrive] Stream started for fileId

[90mstderr[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould retry on 429
[22m[39m[GoogleDrive] Rate limited or server error (429). Retrying in 1000ms...

[90mstderr[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveParent[2m > [22m[2mshould return null on error
[22m[39mFailed to get parent for drive folder childId: Error: API Error
    at [90m/app/[39mtests/main/google-drive-service.test.ts:467:54
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/google-drive-service.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 1849[2mms[22m[39m
[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny record-media-view for unauthorized file
[22m[39m[IPC] Error on record-media-view: Error: Access denied
    at validatePathAccess [90m(/app/[39msrc/main/utils/security-utils.ts:13:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:21:11
    at [90m/app/[39mtests/main/main.ipc-security.test.ts:128:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny db:upsert-metadata for unauthorized file
[22m[39m[IPC] Error on db:upsert-metadata: Error: Access denied
    at validatePathAccess [90m(/app/[39msrc/main/utils/security-utils.ts:13:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:21:11
    at [90m/app/[39mtests/main/main.ipc-security.test.ts:184:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/main.ipc-security.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2443[2mms[22m[39m
     [33m[2mâœ“[22m[39m should deny record-media-view for unauthorized file [33m 2370[2mms[22m[39m
[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles generic error
[22m[39mError: Stream broke
    at [90m/app/[39mtests/server/server.coverage.test.ts:199:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mPOST /api/smart-playlists should handle errors
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:241:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/ls handles error
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:314:61
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mGET /api/drive/parent handles error
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:366:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mPOST /api/media/metadata handles upsert failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:378:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/auth/google-drive/start handles generation failure
[22m[39mError: Auth Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:388:15
    at generateAuthUrl [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/server/routes/auth.routes.ts:23:19
    at [90m/app/[39msrc/server/middleware/async-handler.ts:8:21
    at Layer.handleRequest [90m(/app/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/app/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4mexpress-rate-limit[24m/dist/index.mjs:913:7
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mexpress-rate-limit[24m/dist/index.mjs:796:5

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/files handles list failure
[22m[39mError: List Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:396:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:412:55
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/media/all handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:421:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:434:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPUT /api/smart-playlists/:id handles db failure
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:472:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/metadata/batch handles db failure
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:486:57
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/directories handles sensitive path
[22m[39m[Security] Blocked attempt to add sensitive directory: /etc

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/fs/ls handles restricted path
[22m[39m[Security] Blocked attempt to list restricted directory: /root

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/sources/google-drive handles failure
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:530:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/smart-playlists handles db error
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:540:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/server/server.coverage.test.ts [2m([22m[2m50 tests[22m[2m)[22m[33m 951[2mms[22m[39m
       [33m[2mâœ“[22m[39m POST /api/auth/google-drive/code handles invalid_grant [33m 499[2mms[22m[39m
 [32mâœ“[39m tests/core/vlc-player.test.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1032[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prepare stream url for Drive file [33m 305[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle win32 platform [33m 301[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle darwin platform [33m 302[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.test.ts
[22m[39m[database-worker.js] Worker thread started and ready.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould initialize the database
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould initialize the database
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] Closed existing DB connection before re-init.
[worker] SQLite database initialized at: /app/tests/temp/test-db-roLmzE/new.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould close the database
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould close the database
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould migrate old media_directories schema
[22m[39m[worker] Migrating media_directories table...
[worker] Migration complete.
[worker] SQLite database initialized at: /app/tests/temp/test-db-aObgII/migration_old_schema.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould migrate old media_directories schema
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould record a media view
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould record a media view
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould increment view count
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould increment view count
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould return zero for files with no views
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould return zero for files with no views
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle special characters in file paths
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle special characters in file paths
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle non-existent files (fallback ID generation)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle non-existent files (fallback ID generation)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould generate ID from path for GDrive files
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould generate ID from path for GDrive files
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould NOT call fs.stat during getMediaViewCounts (Optimization Verification)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould NOT call fs.stat during getMediaViewCounts (Optimization Verification)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould NOT call fs.stat during recordMediaView if file is already in DB (Optimization)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould NOT call fs.stat during recordMediaView if file is already in DB (Optimization)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould update file path in DB when file is renamed and played
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould update file path in DB when file is renamed and played
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould cache albums
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould cache albums
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould get cached albums
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould get cached albums
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould return null for non-existent cache
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould return null for non-existent cache
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould overwrite existing cache
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould overwrite existing cache
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (string path)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (string path)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (object payload)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (object payload)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould get media directories
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould get media directories
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould not duplicate directories
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould not duplicate directories
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould re-activate deactivated directories on add
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould re-activate deactivated directories on add
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould remove a media directory
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould remove a media directory
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould set directory active state
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould set directory active state
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory with explicit ID and type
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory with explicit ID and type
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould create and retrieve smart playlists
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould create and retrieve smart playlists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould update and delete smart playlists
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould update and delete smart playlists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle metadata and ratings
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle metadata and ratings
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle partial updates (COALESCE logic)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle partial updates (COALESCE logic)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstderr[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] Error generating file ID for undefined: Error: File path cannot be null or empty
    at generateFileId [90m(/app/[39msrc/core/database-worker.ts:49:13[90m)[39m
    at upsertMetadata [90m(/app/[39msrc/core/database-worker.ts:408:26[90m)[39m
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/database-worker.ts:1195:26[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:93:19
    at new Promise (<anonymous>)
    at sendMessage [90m(/app/[39mtests/core/database-worker.test.ts:71:12[90m)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:547:28
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle setRating message
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle setRating message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getMetadata message
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getMetadata message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getAllMetadataStats message and return only stats
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getAllMetadataStats message and return only stats
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle executeSmartPlaylist message
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle executeSmartPlaylist message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle bulkUpsertMetadata
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle bulkUpsertMetadata
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould not insert any data if ID generation fails for one item (atomic preparation)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstderr[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould not insert any data if ID generation fails for one item (atomic preparation)
[22m[39m[worker] Error generating file ID for undefined: Error: File path cannot be null or empty
    at generateFileId [90m(/app/[39msrc/core/database-worker.ts:49:13[90m)[39m
    at [90m/app/[39msrc/core/database-worker.ts:128:30
    at Array.map (<anonymous>)
    at generateFileIdsBatched [90m(/app/[39msrc/core/database-worker.ts:127:13[90m)[39m
    at bulkUpsertMetadata [90m(/app/[39msrc/core/database-worker.ts:467:25[90m)[39m
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/database-worker.ts:1198:26[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:93:19
    at new Promise (<anonymous>)
    at sendMessage [90m(/app/[39mtests/core/database-worker.test.ts:71:12[90m)[39m

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould not insert any data if ID generation fails for one item (atomic preparation)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle migrations for media_metadata missing columns
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle migrations for media_metadata missing columns
[22m[39m[worker] Closed existing DB connection before re-init.
[worker] Adding missing column file_path to media_metadata...
[worker] Adding missing column size to media_metadata...
[worker] Adding missing column created_at to media_metadata...
[worker] Adding missing column rating to media_metadata...
[worker] Adding missing column extraction_status to media_metadata...
[worker] Adding missing column watched_segments to media_metadata...
[worker] SQLite database initialized at: /app/tests/temp/test-db-veejyJ/mig-test-thg33p.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle migrations for media_metadata missing columns
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould create, update, list, and delete smart playlists
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould create, update, list, and delete smart playlists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould save and retrieve settings
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould save and retrieve settings
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould return recently played items
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould return recently played items
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould return pending metadata file paths
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart playlists, settings, and pending metadata[2m > [22m[2mshould return pending metadata file paths
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgenerateFileId handles filesystem errors other than ENOENT
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgenerateFileId handles filesystem errors other than ENOENT
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgetMetadata with empty array
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgetMetadata with empty array
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgetMediaViewCounts with empty/null array
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mgetMediaViewCounts with empty/null array
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2maddMediaDirectory with defaults
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2maddMediaDirectory with defaults
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mcacheAlbums error handling
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mcacheAlbums error handling
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle getPendingMetadata
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle getPendingMetadata
[22m[39m[worker] Closed existing DB connection before re-init.
[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle getPendingMetadata
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'recordMediaView' should fail gracefully
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'recordMediaView' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'getMediaViewCounts' should fail gracefully
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'getMediaViewCounts' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'addMediaDirectory' should fail gracefully
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'addMediaDirectory' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstderr[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mshould catch top-level errors in message processing
[22m[39m[worker] Error processing message id=242, type=recordMediaView: TypeError: Cannot read properties of null (reading 'filePath')
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/database-worker.ts:1161:50[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:93:19
    at new Promise (<anonymous>)
    at sendMessage [90m(/app/[39mtests/core/database-worker.test.ts:71:12[90m)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:930:28
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)

 [32mâœ“[39m tests/core/database-worker.test.ts [2m([22m[2m69 tests[22m[2m)[22m[33m 354[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mrenders correctly
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mMedia Loading[2m > [22m[2mloads image when currentMediaItem changes
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mMedia Loading[2m > [22m[2mretains old mediaUrl when switching between media types to allow smooth transition
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mMedia Loading[2m > [22m[2mhandles load error via generator exception
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould handle errors
[22m[39mError: Db error
    at [90m/app/[39mtests/server/server.test.ts:238:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mMedia Loading[2m > [22m[2mhandles load error via generator exception
[22m[39mError loading media: Error: Generator failed
    at ObjectRefImpl.mockLibraryState.mediaUrlGenerator [as _value] [90m(/app/[39mtests/renderer/components/MediaDisplay.test.ts:220:15[90m)[39m
    at loadMediaUrl [90m(/app/[39msrc/renderer/components/MediaDisplay.vue:513:37[90m)[39m
    at immediate [90m(/app/[39msrc/renderer/components/MediaDisplay.vue:779:5[90m)[39m
    at callWithErrorHandling [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:200:19[90m)[39m
    at callWithAsyncErrorHandling [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:207:17[90m)[39m
    at baseWatchOptions.call [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:877:47[90m)[39m
    at job [90m(/app/[39mnode_modules/[4m@vue/reactivity[24m/dist/reactivity.cjs.js:1893:18[90m)[39m
    at Object.watch [90m(/app/[39mnode_modules/[4m@vue/reactivity[24m/dist/reactivity.cjs.js:1928:7[90m)[39m
    at doWatch [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:905:34[90m)[39m
    at watch [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:838:10[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mSub-component Interactions[2m > [22m[2mhandles set-rating event from MediaControls
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mSub-component Interactions[2m > [22m[2mhandles navigation events from MediaControls
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould handle errors
[22m[39mError: Db error
    at [90m/app/[39mtests/server/server.test.ts:269:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mSub-component Interactions[2m > [22m[2mhandles buffering event from VideoPlayer
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers Space key to toggle play
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers setRating error branch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleMediaError transcoding branch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould handle errors
[22m[39mError: error
    at [90m/app/[39mtests/server/server.test.ts:301:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleMediaError transcoding branch
[22m[39mMedia playback error, attempting auto-transcode...

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleMediaError transcoding branch
[22m[39mHLS URL: /api/hls/master.m3u8?file=test

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers proactive transcoding for legacy formats
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers proactive transcoding for legacy formats
[22m[39mProactively transcoding legacy format: t.mov

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers proactive transcoding for legacy formats
[22m[39mHLS URL: /api/hls/master.m3u8?file=test

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleVideoPlay and handleVideoPause effects on timer
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleMediaError in transcoding mode
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers tryTranscoding requestId mismatch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers setRating unrate branch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers setRating unrate branch
[22m[39mFailed to set rating Error: fail
    at [90m/app/[39mtests/renderer/components/MediaDisplay.test.ts:296:49
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers loadMediaUrl null currentMediaItem
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers loadMediaUrl videoElement cleanup fallback
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleBuffering while transcoding loading
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers openInVlc failure branch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers handleVideoElementUpdate
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/media/history[2m > [22m[2mshould handle errors
[22m[39mError: Db error
    at [90m/app/[39mtests/server/server.test.ts:342:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers request cancellation guards
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers currentVideoTime getter fallback
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers currentMediaItem watch resumeSlideshowTimer branch
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould handle error
[22m[39mError: error
    at [90m/app/[39mtests/server/server.test.ts:369:61
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers Try Transcoding button click
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers Try Transcoding button click
[22m[39mHLS URL: /api/hls/master.m3u8?file=test

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mdoes NOT resume timer when video is paused due to navigation (loading)
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mdoes resume timer when video is paused manually (not navigating)
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers currentLoadRequestId mismatch in tryTranscoding
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers currentLoadRequestId mismatch AFTER async gap in tryTranscoding
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers currentLoadRequestId mismatch AFTER async gap in tryTranscoding
[22m[39mHLS URL: /api/hls/master.m3u8?file=test

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers fullscreen toggle for VR mode
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers fullscreen toggle for normal video
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers fullscreen exit for normal video
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mcovers fullscreen error handling
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mdoes not throw when seeking forward if video duration is NaN
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mdoes not throw when seeking backward if video duration is NaN
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mEmpty State UX[2m > [22m[2mshows "Open Library" button when sidebar is hidden and no media selected
[22m[39m[Vue warn] toRefs() expects a reactive object but received a plain one.

 [32mâœ“[39m tests/renderer/components/MediaDisplay.test.ts [2m([22m[2m35 tests[22m[2m)[22m[33m 445[2mms[22m[39m
 [32mâœ“[39m tests/server/server.test.ts [2m([22m[2m49 tests[22m[2m)[22m[33m 787[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveMetadata[2m > [22m[2mreturns 500 if auth check throws
[22m[39m[Access] Validation error: Error: Auth error
    at [90m/app/[39mtests/core/media-handler.test.ts:325:47
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrenders initial directory listing
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates into directory on double click
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1'

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveStaticFile[2m > [22m[2mhandles internal errors
[22m[39m[Access] Validation error: Error: Boom
    at [90m/app/[39mtests/core/media-handler.test.ts:669:47
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates into directory on double click
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1/SubFolder'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not navigate on double click if not a directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mselects a directory on click
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mhandleStreamRequest[2m > [22m[2mhandles initialization errors
[22m[39m[Handler] Stream failed: Error: Init fail
    at [90m/app/[39mtests/core/media-handler.test.ts:769:15
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at processStream [90m(/app/[39msrc/core/media-handler.ts:145:18[90m)[39m
    at Module.handleStreamRequest [90m(/app/[39msrc/core/media-handler.ts:189:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:772:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2memits select event when clicking Select Directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mhandles process error
[22m[39m[Transcode] Spawn Error: Error: Process Error
    at [90m/app/[39mtests/core/media-handler.test.ts:845:28
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mclears selection when clicking a file
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2memits cancel event
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates up when up button is clicked
[22m[39m[FileExplorer] loadDirectory mode=local path='/parent/child'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates up when up button is clicked
[22m[39m[FileExplorer] loadDirectory mode=local path='/parent'

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mgenerateFileUrl[2m > [22m[2mshould handle fs errors gracefully
[22m[39m[media-handler] Error processing /local/file.mp4 in generateFileUrl: Error: FS Error
    at [90m/app/[39mtests/core/media-handler.test.ts:925:36
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes directory on refresh button click
[22m[39m[FileExplorer] loadDirectory mode=local path='/current'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes directory on refresh button click
[22m[39m[FileExplorer] loadDirectory mode=local path='/current'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdisplays error message when listing fails
[22m[39m[FileExplorer] loadDirectory mode=local path='/error'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles empty directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/empty'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2msorts directories first
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mcorrectly identifies drive roots with different cases
[22m[39m[FileExplorer] loadDirectory mode=local path='ROOT'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mcorrectly identifies unix root / as drive
[22m[39m[FileExplorer] loadDirectory mode=local path='ROOT'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mtoggles view mode between list and grid
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive mode initial load
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive mode initial load
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mAdditional Integration Coverage[2m > [22m[2mStatic File Middleware normalizes Windows paths with leading slash
[22m[39m[ServeStatic] Access denied during re-validation: [90mundefined[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-id'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigateUp works correctly in local mode
[22m[39m[FileExplorer] loadDirectory mode=local path='/some/path'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigateUp works correctly in local mode
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mHLS Serving[2m > [22m[2mserveHlsPlaylist[2m > [22m[2mhandles session missing dir
[22m[39m[HLS] Playlist error: Error: Session dir not found
    at Module.serveHlsPlaylist [90m(/app/[39msrc/core/hls-handler.ts:79:28[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:1153:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mallows selection of directories in Google Drive grid view
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mallows selection of directories in Google Drive grid view
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 2 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not select files in Google Drive grid view
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not select files in Google Drive grid view
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveHeatmap[2m > [22m[2mhandles analyzer errors
[22m[39m[Heatmap] Error generating heatmap: Error: Analyzer Fail
    at [90m/app/[39mtests/core/media-handler.test.ts:1298:52
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-abc'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-abc'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveHlsPlaylist - Additional Coverage[2m > [22m[2mhandles session creation failure
[22m[39m[HLS] Playlist error: Error: Session creation failed
    at [90m/app/[39mtests/core/media-handler.test.ts:1346:30
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='sub-folder'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mhandleStreamRequest - Edge Case Coverage[2m > [22m[2mhandles tryServeDirectFile failure gracefully
[22m[39m[Handler] SendFile check failed: Error: sendFile error
    at Object.<anonymous> [90m(/app/[39mtests/core/media-handler.test.ts:1378:17[90m)[39m
    at Object.Mock [as sendFile] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at tryServeDirectFile [90m(/app/[39msrc/core/media-handler.ts:123:9[90m)[39m
    at Module.handleStreamRequest [90m(/app/[39msrc/core/media-handler.ts:184:31[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:1385:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mhandleStreamRequest - Edge Case Coverage[2m > [22m[2mhandles tryServeDirectFile failure gracefully
[22m[39m[Handler] Stream failed: Error: Immediate Fail
    at [90m/app/[39mtests/core/media-handler.test.ts:1040:15
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at processStream [90m(/app/[39msrc/core/media-handler.ts:145:18[90m)[39m
    at Module.handleStreamRequest [90m(/app/[39msrc/core/media-handler.ts:189:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:1385:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Local mode
[22m[39m[FileExplorer] loadDirectory mode=local path='/some/path'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Local mode
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes at root (My PC) correctly
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes at root (My PC) correctly
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mhandleStreamRequest - Edge Case Coverage[2m > [22m[2mhandles validateFileAccess catch block in handleStreamRequest
[22m[39m[Access] Validation error: Error: Validation crash
    at [90m/app/[39mtests/core/media-handler.test.ts:1411:47
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates on Enter key press
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

 [32mâœ“[39m tests/core/media-handler.test.ts [2m([22m[2m67 tests[22m[2m)[22m[33m 333[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates on Enter key press
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1'

 [32mâœ“[39m tests/renderer/components/FileExplorer.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 332[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGrid.coverage.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 420[2mms[22m[39m
[90mstdout[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mlistDriveDirectory handles generic files and shortcuts
[22m[39m[GoogleDrive] listDriveDirectory 'root' found 3 items.

 [32mâœ“[39m tests/renderer/components/AlbumsList.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 574[2mms[22m[39m
[90mstderr[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mlistDriveDirectory handles error
[22m[39m[GoogleDriveService] Error listing files for query 'root' in parents and trashed = false: Error: List failed
    at [90m/app/[39mtests/main/google-drive-service.coverage.test.ts:172:36
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mgetDriveParent returns parent
[22m[39mFailed to get parent for drive folder child: Error: Fail
    at [90m/app/[39mtests/main/google-drive-service.coverage.test.ts:190:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mgetDriveFileStream returns stream
[22m[39m[GoogleDrive] Stream started for id

 [32mâœ“[39m tests/main/google-drive-service.coverage.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 651[2mms[22m[39m
 [32mâœ“[39m tests/server/server.gdrive.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 603[2mms[22m[39m
     [33m[2mâœ“[22m[39m GET /api/auth/google-drive/start returns URL [33m 525[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGrid.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 322[2mms[22m[39m
[90mstderr[2m | tests/server/server.dos.test.ts[2m > [22m[2mServer DoS Protection[2m > [22m[2mshould rate limit the Google Auth endpoint
[22m[39m[Security] Rate limit exceeded for POST /api/auth/google-drive/code from ::ffff:127.0.0.1

[90mstderr[2m | tests/server/server.dos.test.ts[2m > [22m[2mServer DoS Protection[2m > [22m[2mshould rate limit directory additions
[22m[39m[Security] Rate limit exceeded for POST /api/directories from ::ffff:127.0.0.1

[90mstderr[2m | tests/server/server.dos.test.ts[2m > [22m[2mServer DoS Protection[2m > [22m[2mshould rate limit smart playlist creation
[22m[39m[Security] Rate limit exceeded for POST /api/smart-playlists from ::ffff:127.0.0.1

[90mstderr[2m | tests/server/server.dos.test.ts[2m > [22m[2mServer DoS Protection[2m > [22m[2mshould rate limit media rating
[22m[39m[Security] Rate limit exceeded for POST /api/media/rate from ::ffff:127.0.0.1

 [32mâœ“[39m tests/server/server.dos.test.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 568[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/App.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 575[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/SourcesModal.test.ts[2m > [22m[2mSourcesModal.vue[2m > [22m[2mshould open FileExplorer when add button clicked
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/SourcesModal.test.ts[2m > [22m[2mSourcesModal.vue[2m > [22m[2mshould call addMediaDirectory when FileExplorer selects a path
[22m[39m[FileExplorer] loadDirectory mode=local path=''

 [32mâœ“[39m tests/renderer/components/SourcesModal.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 494[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/MediaDisplay.coverage.test.ts[2m > [22m[2mMediaDisplay.vue Additional Coverage[2m > [22m[2mAdditional Branch Coverage[2m > [22m[2mshould throw error if mediaUrlGenerator is missing
[22m[39mError loading media: Error: Media URL generator not ready
    at loadMediaUrl [90m(/app/[39msrc/renderer/components/MediaDisplay.vue:521:13[90m)[39m
    at immediate [90m(/app/[39msrc/renderer/components/MediaDisplay.vue:779:5[90m)[39m
    at callWithErrorHandling [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:200:19[90m)[39m
    at callWithAsyncErrorHandling [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:207:17[90m)[39m
    at baseWatchOptions.call [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:877:47[90m)[39m
    at job [90m(/app/[39mnode_modules/[4m@vue/reactivity[24m/dist/reactivity.cjs.js:1893:18[90m)[39m
    at Object.watch [90m(/app/[39mnode_modules/[4m@vue/reactivity[24m/dist/reactivity.cjs.js:1928:7[90m)[39m
    at doWatch [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:905:34[90m)[39m
    at watch [90m(/app/[39mnode_modules/[4m@vue/runtime-core[24m/dist/runtime-core.cjs.js:838:10[90m)[39m
    at setup [90m(/app/[39msrc/renderer/components/MediaDisplay.vue:776:1[90m)[39m

 [32mâœ“[39m tests/renderer/components/MediaDisplay.coverage.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 334[2mms[22m[39m
 [32mâœ“[39m tests/repro_vlc_injection.spec.ts [2m([22m[2m1 test[22m[2m)[22m[33m 315[2mms[22m[39m
     [33m[2mâœ“[22m[39m should prevent argument injection when opening local file [33m 312[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/Palette.a11y.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 445[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/SmartPlaylistModal.coverage.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 210[2mms[22m[39m
[90mstderr[2m | tests/main/vlc.security.test.ts[2m > [22m[2mSecurity: open-in-vlc[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[Security] Access denied to file outside media directories: (resolved from /etc/passwd)

 [32mâœ“[39m tests/main/vlc.security.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 151[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/ProgressBars.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 195[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/VideoPlayer.test.ts[2m > [22m[2mVideoPlayer.vue[2m > [22m[2mhandles HLS errors and attempts recovery
[22m[39mHLS Fatal Error: { fatal: [33mtrue[39m, type: [32m'networkError'[39m }
HLS Fatal Error: { fatal: [33mtrue[39m, type: [32m'mediaError'[39m }

[90mstderr[2m | tests/renderer/components/VideoPlayer.test.ts[2m > [22m[2mVideoPlayer.vue[2m > [22m[2mfalls back to native HLS if Hls.js not supported
[22m[39m[Vue warn]: Do not use built-in or reserved HTML elements as component id: video
[Vue warn]: Do not use built-in or reserved HTML elements as component id: video

 [32mâœ“[39m tests/renderer/components/VideoPlayer.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 141[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/VRVideoPlayer.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 311[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaControls.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 250[2mms[22m[39m
 [32mâœ“[39m tests/server/server.validation.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 353[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMediaViewCounts returns empty object when no views exist
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMediaViewCounts returns empty object when no views exist
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMediaViewCounts returns correct counts
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMediaViewCounts returns correct counts
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMetadata returns empty object when no metadata exists
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMetadata returns empty object when no metadata exists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMetadata returns correct metadata map
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetAllMetadata returns correct metadata map
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mhandles database initialization errors for getAll functions
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mhandles database initialization errors for getAll functions
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mrecordMediaView handles empty file path via generateFileId fallback
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mrecordMediaView handles empty file path via generateFileId fallback
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetMetadata handles batching and padding
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetMetadata handles batching and padding
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetMetadata handles exact batch size
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgetMetadata handles exact batch size
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgenerateFileIdsBatched handles database query failure gracefully
[22m[39m[worker] SQLite database initialized at: /app/tests/core/temp_coverage.db

[90mstdout[2m | tests/core/database-worker.coverage.test.ts[2m > [22m[2mdatabase-worker coverage (exported functions)[2m > [22m[2mgenerateFileIdsBatched handles database query failure gracefully
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/database-worker.coverage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 268[2mms[22m[39m
 [32mâœ“[39m tests/core/media-handler.class.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 280[2mms[22m[39m
[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould return cached data if available
[22m[39m[MediaAnalyzer] Generating heatmap for test.mp4 with 1 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould run ffmpeg and parse output if cache misses
[22m[39m[MediaAnalyzer] Generating heatmap for test.mp4 with 2 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould run ffmpeg and parse output if cache misses
[22m[39m[MediaAnalyzer] Parsed 2 motion samples and 2 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle ffmpeg errors
[22m[39m[MediaAnalyzer] Generating heatmap for error.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle ffmpeg errors
[22m[39m[MediaAnalyzer] FFmpeg exited with code 1
[MediaAnalyzer] Stderr:

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould resolve even if caching fails (write error)
[22m[39m[MediaAnalyzer] Generating heatmap for file.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould resolve even if caching fails (write error)
[22m[39m[MediaAnalyzer] Warning: Zero samples found for file.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould resolve even if caching fails (write error)
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould resolve even if caching fails (write error)
[22m[39m[MediaAnalyzer] Failed to write cache Error: Write failed
    at [90m/app/[39mtests/core/analysis/media-analyzer.test.ts:160:45
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould skip cache if cacheDir is not set
[22m[39m[MediaAnalyzer] Generating heatmap for file.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould skip cache if cacheDir is not set
[22m[39m[MediaAnalyzer] Warning: Zero samples found for file.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould skip cache if cacheDir is not set
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with empty data
[22m[39m[MediaAnalyzer] Generating heatmap for empty.mp4 with 5 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with empty data
[22m[39m[MediaAnalyzer] Warning: Zero samples found for empty.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with empty data
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with more points than data (upsampling)
[22m[39m[MediaAnalyzer] Generating heatmap for small.mp4 with 8 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with more points than data (upsampling)
[22m[39m[MediaAnalyzer] Parsed 4 motion samples and 4 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with fewer points than data (downsampling)
[22m[39m[MediaAnalyzer] Generating heatmap for large.mp4 with 2 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle resampling with fewer points than data (downsampling)
[22m[39m[MediaAnalyzer] Parsed 4 motion samples and 4 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould log warning if ffmpeg succeeds but stderr contains Error
[22m[39m[MediaAnalyzer] Generating heatmap for warning.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould log warning if ffmpeg succeeds but stderr contains Error
[22m[39m[MediaAnalyzer] FFmpeg succeeded but reported errors: Some random Error occurred

[MediaAnalyzer] Warning: Zero samples found for warning.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould log warning if ffmpeg succeeds but stderr contains Error
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould ignore irrelevant output lines
[22m[39m[MediaAnalyzer] Generating heatmap for mixed.mp4 with 1 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould ignore irrelevant output lines
[22m[39m[MediaAnalyzer] Parsed 1 motion samples and 1 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Generating heatmap for file1 with 100 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Warning: Zero samples found for file1
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Generating heatmap for file2 with 1 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Warning: Zero samples found for file2
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Generating heatmap for file3 with 1000 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould sanitize points parameter
[22m[39m[MediaAnalyzer] Warning: Zero samples found for file3
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould reject on unexpected parsing error
[22m[39m[MediaAnalyzer] Generating heatmap for parse-error.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould reject on unexpected parsing error
[22m[39m[MediaAnalyzer] Warning: Zero samples found for parse-error.mp4
[MediaAnalyzer] Output sample (last 5 lines):
[MediaAnalyzer] Parse error: Error: Forced Error
    at MediaAnalyzer.<anonymous> [90m(/app/[39mtests/core/analysis/media-analyzer.test.ts:314:13[90m)[39m
    at MediaAnalyzer.resample [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/analysis/media-analyzer.ts:327:41[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at Timeout._onTimeout [90m(/app/[39mtests/core/analysis/media-analyzer.test.ts:100:23[90m)[39m
[90m    at listOnTimeout (node:internal/timers:588:17)[39m
[90m    at processTimers (node:internal/timers:523:7)[39m

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould reject on unexpected parsing error
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle invalid parsing values
[22m[39m[MediaAnalyzer] Generating heatmap for invalid.mp4 with 10 points

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle invalid parsing values
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mshould handle invalid parsing values
[22m[39m[MediaAnalyzer] Warning: Zero samples found for invalid.mp4
[MediaAnalyzer] Output sample (last 5 lines): lavfi.signalstats.YDIF=NaN
lavfi.astats.Overall.RMS_level=invalid

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mgetProgress[2m > [22m[2mreturns progress when job is active
[22m[39m[MediaAnalyzer] Generating heatmap for test.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mgetProgress[2m > [22m[2mreturns progress when job is active
[22m[39m[MediaAnalyzer] Warning: Zero samples found for test.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mgetProgress[2m > [22m[2mreturns progress when job is active
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mDuplicate job handling[2m > [22m[2mjoins existing job instead of creating duplicate
[22m[39m[MediaAnalyzer] Generating heatmap for same-file.mp4 with 10 points

 [32mâœ“[39m tests/renderer/components/MediaGrid.virtual.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 227[2mms[22m[39m
[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mDuplicate job handling[2m > [22m[2mjoins existing job instead of creating duplicate
[22m[39m[MediaAnalyzer] Warning: Zero samples found for same-file.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mDuplicate job handling[2m > [22m[2mjoins existing job instead of creating duplicate
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses duration from stderr
[22m[39m[MediaAnalyzer] Generating heatmap for duration-test.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses duration from stderr
[22m[39m[MediaAnalyzer] Warning: Zero samples found for duration-test.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses duration from stderr
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses progress from stderr time updates
[22m[39m[MediaAnalyzer] Generating heatmap for progress-test.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses progress from stderr time updates
[22m[39m[MediaAnalyzer] Warning: Zero samples found for progress-test.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mstderr parsing and progress tracking[2m > [22m[2mparses progress from stderr time updates
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mTimeout Handling[2m > [22m[2mshould set up timeout when spawning ffmpeg
[22m[39m[MediaAnalyzer] Generating heatmap for test.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mTimeout Handling[2m > [22m[2mshould set up timeout when spawning ffmpeg
[22m[39m[MediaAnalyzer] Warning: Zero samples found for test.mp4
[MediaAnalyzer] Output sample (last 5 lines):

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mTimeout Handling[2m > [22m[2mshould set up timeout when spawning ffmpeg
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mError Scenarios[2m > [22m[2mshould handle spawn error event
[22m[39m[MediaAnalyzer] Generating heatmap for error.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.test.ts[2m > [22m[2mMediaAnalyzer[2m > [22m[2mError Scenarios[2m > [22m[2mshould handle spawn error event
[22m[39m[MediaAnalyzer] Failed to start ffmpeg process: Error: Spawn failed
    at Timeout._onTimeout [90m(/app/[39mtests/core/analysis/media-analyzer.test.ts:508:35[90m)[39m
[90m    at listOnTimeout (node:internal/timers:588:17)[39m
[90m    at processTimers (node:internal/timers:523:7)[39m

 [32mâœ“[39m tests/core/analysis/media-analyzer.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 168[2mms[22m[39m
[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould start server and set port
[22m[39m[local-server.js] Local media server started on http://localhost:33971

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould start server and set port
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Local media server started on http://localhost:42805

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Server already started. Ignoring request.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould ignore start request if server is already running (callback)
[22m[39m[local-server.js] Local media server started on http://localhost:44157

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould ignore start request if server is already running (callback)
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle start without callback when running
[22m[39m[local-server.js] Local media server started on http://localhost:33393

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle start without callback when running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould stop the server
[22m[39m[local-server.js] Local media server started on http://localhost:41159

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould stop the server
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle stop without callback
[22m[39m[local-server.js] Local media server started on http://localhost:39597

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle stop without callback
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mgetServerPort[2m > [22m[2mshould return port when server is running
[22m[39m[local-server.js] Local media server started on http://localhost:38747

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mgetServerPort[2m > [22m[2mshould return port when server is running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve a file successfully
[22m[39m[local-server.js] Local media server started on http://localhost:42819

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve a file successfully
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[local-server.js] Local media server started on http://localhost:43165

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[Security] Access denied to file outside media directories: (resolved from /nonexistent-file.txt)

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould handle range requests
[22m[39m[local-server.js] Local media server started on http://localhost:45409

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould handle range requests
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 416 for invalid range
[22m[39m[local-server.js] Local media server started on http://localhost:35929

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 416 for invalid range
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve video files with correct MIME type
[22m[39m[local-server.js] Local media server started on http://localhost:35559

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve video files with correct MIME type
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[local-server.js] Local media server started on http://localhost:35983

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[Security] Access denied to file outside media directories: (resolved from //app/tests/forbidden/forbidden-file.txt)

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[local-server.js] Local media server started on http://localhost:37787

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[Access] Validation error: Error: Database error
    at [90m/app/[39mtests/main/local-server.test.ts:388:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mServer Error Handling[2m > [22m[2mshould handle server listen errors gracefully
[22m[39m[local-server.js] Local media server started on http://localhost:12345

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle callback parameter correctly
[22m[39m[local-server.js] Local media server started on http://localhost:42251

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle callback parameter correctly
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould log an error if closing fails
[22m[39m[local-server.js] Local media server started on http://localhost:12345

 [32mâœ“[39m tests/main/local-server.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 217[2mms[22m[39m
 [32mâœ“[39m tests/renderer/utils/albumUtils.perf.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 207[2mms[22m[39m
[90mstderr[2m | tests/server/security.test.ts[2m > [22m[2mServer Security Enhancements[2m > [22m[2mshould enforce rate limits on sensitive endpoints
[22m[39m[Security] Rate limit exceeded for POST /api/auth/google-drive/code from ::ffff:127.0.0.1

[90mstdout[2m | tests/server/security.test.ts[2m > [22m[2mServer Configuration[2m > [22m[2mshould set a timeout on the HTTPS server to prevent Slowloris
[22m[39mSSL Certificates found.

 [32mâœ“[39m tests/server/security.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 186[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaDisplayVlc.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 192[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumsList.coverage.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 155[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/SmartPlaylistModal.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 136[2mms[22m[39m
 [32mâœ“[39m tests/server/app.coverage.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 127[2mms[22m[39m
[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mlogs an error when worker exits unexpectedly
[22m[39m[database.js] Attempting restart 1/5 in 2000ms...

 [32mâœ“[39m tests/main/database.test.ts [2m([22m[2m43 tests[22m[2m)[22m[32m 47[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgetMetadata: should skip fs.stat for files already in database
[22m[39m[worker] SQLite database initialized at: /app/test-db-batch-1770936157374.sqlite

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgetMetadata: should skip fs.stat for files already in database
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgetMetadata: should call fs.stat only for new files
[22m[39m[worker] SQLite database initialized at: /app/test-db-batch-1770936157427.sqlite

 [32mâœ“[39m tests/renderer/components/AlbumTree.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 282[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgetMetadata: should call fs.stat only for new files
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mbulkUpsertMetadata: should use batched ID lookup
[22m[39m[worker] SQLite database initialized at: /app/test-db-batch-1770936157457.sqlite

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mbulkUpsertMetadata: should use batched ID lookup
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgenerateFileIdsBatched handles batching correctly
[22m[39m[worker] SQLite database initialized at: /app/test-db-batch-1770936157487.sqlite

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgenerateFileIdsBatched handles batching correctly
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgenerateFileIdsBatched handles exact batch size (900)
[22m[39m[worker] SQLite database initialized at: /app/test-db-batch-1770936157513.sqlite

[90mstdout[2m | tests/core/database-worker.batch-optimization.test.ts[2m > [22m[2mdatabase-worker batch optimization[2m > [22m[2mgenerateFileIdsBatched handles exact batch size (900)
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/database-worker.batch-optimization.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 188[2mms[22m[39m
 [32mâœ“[39m tests/server/server.serve.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 194[2mms[22m[39m
[90mstderr[2m | tests/main/google-drive-service.input.test.ts[2m > [22m[2mGoogle Drive Service Input Validation[2m > [22m[2mshould prevent query injection in listDriveDirectory
[22m[39m[Security] Blocked invalid Drive folder ID: ' or trashed = false or '1'='1

[90mstdout[2m | tests/main/google-drive-service.input.test.ts[2m > [22m[2mGoogle Drive Service Input Validation[2m > [22m[2mshould allow valid folder IDs
[22m[39m[GoogleDrive] listDriveDirectory 'root' found 0 items.

[90mstdout[2m | tests/main/google-drive-service.input.test.ts[2m > [22m[2mGoogle Drive Service Input Validation[2m > [22m[2mshould allow valid folder IDs
[22m[39m[GoogleDrive] listDriveDirectory '12345' found 0 items.

[90mstdout[2m | tests/main/google-drive-service.input.test.ts[2m > [22m[2mGoogle Drive Service Input Validation[2m > [22m[2mshould allow valid folder IDs
[22m[39m[GoogleDrive] listDriveDirectory 'AbCdEf_-123' found 0 items.

 [32mâœ“[39m tests/main/google-drive-service.input.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 187[2mms[22m[39m
[90mstderr[2m | tests/server/path_length.test.ts[2m > [22m[2mPath Length Validation[2m > [22m[2mshould reject paths longer than MAX_PATH_LENGTH for 'POST /api/directories'
[22m[39m[Security] Rejected overly long file path (4197 chars)

[90mstderr[2m | tests/server/path_length.test.ts[2m > [22m[2mPath Length Validation[2m > [22m[2mshould reject paths longer than MAX_PATH_LENGTH for 'DELETE /api/directories'
[22m[39m[Security] Rejected overly long file path (4197 chars)

[90mstderr[2m | tests/server/path_length.test.ts[2m > [22m[2mPath Length Validation[2m > [22m[2mshould reject paths longer than MAX_PATH_LENGTH for 'PUT /api/directories/active'
[22m[39m[Security] Rejected overly long file path (4197 chars)

[90mstderr[2m | tests/server/path_length.test.ts[2m > [22m[2mPath Length Validation[2m > [22m[2mshould reject paths longer than MAX_PATH_LENGTH for 'GET /api/fs/ls'
[22m[39m[Security] Rejected overly long file path (4197 chars)

[90mstderr[2m | tests/server/path_length.test.ts[2m > [22m[2mPath Length Validation[2m > [22m[2mshould reject paths longer than MAX_PATH_LENGTH for 'GET /api/fs/parent'
[22m[39m[Security] Rejected overly long file path (4197 chars)

 [32mâœ“[39m tests/server/path_length.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 205[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaControls.sidebar.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 175[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaControls.extra.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 116[2mms[22m[39m
[90mstderr[2m | tests/core/media-service-filter.test.ts[2m > [22m[2mMediaService Filter Optimization[2m > [22m[2mshould call filterProcessingNeeded with all found paths
[22m[39m[media-service] Error extracting metadata for /a.mp4: TypeError: Cannot read properties of undefined (reading 'size')
    at [90m/app/[39msrc/core/media-service.ts:348:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36
[media-service] Error extracting metadata for /b.mp4: TypeError: Cannot read properties of undefined (reading 'size')
    at [90m/app/[39msrc/core/media-service.ts:348:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36
[media-service] Error extracting metadata for /c.mp4: TypeError: Cannot read properties of undefined (reading 'size')
    at [90m/app/[39msrc/core/media-service.ts:348:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36

[90mstderr[2m | tests/core/media-service-filter.test.ts[2m > [22m[2mMediaService Filter Optimization[2m > [22m[2mshould only pass needed paths to extractAndSaveMetadata
[22m[39m[media-service] Error extracting metadata for /new.mp4: TypeError: Cannot read properties of undefined (reading 'size')
    at [90m/app/[39msrc/core/media-service.ts:348:25
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36

 [32mâœ“[39m tests/core/media-service-filter.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 111[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.filter.test.ts
[22m[39m[database-worker.js] Worker thread started and ready.

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould filter out paths that are already success
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould filter out paths that are already success
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould handle batching correctly
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould handle batching correctly
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould return empty array if all input files are success
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould return empty array if all input files are success
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould return all files if none are success
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.filter.test.ts[2m > [22m[2mDatabase Worker Filter Optimization[2m > [22m[2mshould return all files if none are success
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/database-worker.filter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 96[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/App.branch.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/server/server.transcode-limit.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGridItem.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 93[2mms[22m[39m
 [32mâœ“[39m tests/server/system_type_validation.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m tests/renderer/google-drive.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 102[2mms[22m[39m
 [32mâœ“[39m tests/server/server.idor.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 99[2mms[22m[39m
 [32mâœ“[39m tests/server/cors.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 100[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaDisplay.vlc.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 85[2mms[22m[39m
[90mstderr[2m | tests/server/server.security.test.ts[2m > [22m[2mServer Security[2m > [22m[2mPOST /api/directories (Sensitive Paths)[2m > [22m[2mshould block adding root directory
[22m[39m[Security] Blocked attempt to add sensitive directory: /

[90mstderr[2m | tests/server/server.security.test.ts[2m > [22m[2mServer Security[2m > [22m[2mPOST /api/directories (Sensitive Paths)[2m > [22m[2mshould block adding system directories
[22m[39m[Security] Blocked attempt to add sensitive directory: /etc

 [32mâœ“[39m tests/server/server.security.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 99[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/MediaDisplay.concurrency.test.ts[2m > [22m[2mMediaDisplay Race Condition[2m > [22m[2mcorrectly handles overlapping states: Transcoding text replaces Loading text
[22m[39mProactively transcoding legacy format: legacy.mkv

[90mstdout[2m | tests/renderer/components/MediaDisplay.concurrency.test.ts[2m > [22m[2mMediaDisplay Race Condition[2m > [22m[2mcorrectly handles overlapping states: Transcoding text replaces Loading text
[22m[39mHLS URL: [90mundefined[39m

 [32mâœ“[39m tests/renderer/components/MediaDisplay.concurrency.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 77[2mms[22m[39m
[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return all media when filter is "All"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return only videos when filter is "Videos"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return only images when filter is "Images"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return all media if filter is not "Videos" or "Images"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mstartSlideshow[2m > [22m[2mshould handle when no albums are selected
[22m[39mNo albums selected for slideshow.

 [32mâœ“[39m tests/renderer/composables/useSlideshow.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 39[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.integration.test.ts[2m > [22m[2mmedia-handler integration tests[2m > [22m[2mgenerateFileUrl handles errors from provider
[22m[39m[media-handler] Error processing /file.mp4 in generateFileUrl: Error: Metadata failure (intentional)
    at [90m/app/[39mtests/core/media-handler.integration.test.ts:77:28
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-handler.integration.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 76[2mms[22m[39m
 [32mâœ“[39m tests/server/server.batch-limit.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 88[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGrid.virtual-keys.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 77[2mms[22m[39m
[90mstderr[2m | tests/server/media.routes.coverage.test.ts[2m > [22m[2mMedia routes additional coverage[2m > [22m[2mGET /api/stream cleans up on transcode errors
[22m[39mError: Transcode failed
    at [90m/app/[39mtests/server/media.routes.coverage.test.ts:137:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/server/media.routes.coverage.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 70[2mms[22m[39m
 [32mâœ“[39m tests/core/database-schema.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 50[2mms[22m[39m
 [32mâœ“[39m tests/core/thumbnail-generation.integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 84[2mms[22m[39m
 [32mâœ“[39m tests/components/KeyboardShortcutsModal.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 67[2mms[22m[39m
 [32mâœ“[39m tests/core/media-service-metadata-optimization.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 91[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useLibraryStore.coverage.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 70[2mms[22m[39m
[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath returns existing cache
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles metadata fetch error
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles metadata fetch error
[22m[39m[DriveCache] Failed to fetch metadata: Error: Meta Fail
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:99:7
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mreuses cached metadata on subsequent calls
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath resumes partial download
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath downloads file on cache miss
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles download error (start fail)
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles download error (start fail)
[22m[39m[DriveCache] Failed to start download: error-file Error: Download Fail
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:199:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mhandles stream error properly
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mhandles stream error properly
[22m[39m[DriveCache] Drive Stream error for stream-error-file: Error: Stream Dies
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:238:36
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mactive download handles concurrent requests
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup deletes files
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup deletes files
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup handles error
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mthrows when getting manager before initialization
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:280:13[90m)[39m
    at Object.Mock [as rmSync] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:170:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:198:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:60:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at runHook [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1514:51[90m)[39m

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mthrows when getting manager before initialization
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:280:13[90m)[39m
    at Object.Mock [as rmSync] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:170:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:198:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:323:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanupDriveCacheManager is safe when no instance exists
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:280:13[90m)[39m
    at Object.Mock [as rmSync] [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:170:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:198:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:330:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m

 [32mâœ“[39m tests/main/drive-cache-manager.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/MediaDisplay.extra.test.ts[2m > [22m[2mMediaDisplay Extra Coverage[2m > [22m[2mtracks watched segments
[22m[39m[Vue warn]: Invalid watch source:  { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <VideoPlayer ref="videoPlayerRef" key="video.mp4-video" src="http://localhost/media/video.mp4"  ... >
  at <Transition key=0 name="media-fade" mode="out-in" >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <MediaControls ref="mediaControlsRef" class="floating-controls" current-media-item= { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } }  ... >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>

[90mstderr[2m | tests/renderer/components/MediaDisplay.extra.test.ts[2m > [22m[2mMediaDisplay Extra Coverage[2m > [22m[2mhandles keyboard shortcuts for navigation and seek
[22m[39m[Vue warn]: Invalid watch source:  { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <MediaControls ref="mediaControlsRef" class="floating-controls" current-media-item= { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } }  ... >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <MediaControls ref="mediaControlsRef" class="floating-controls" current-media-item= { value: { path: [32m'video.mp4'[39m, name: [32m'video.mp4'[39m } }  ... >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>

 [32mâœ“[39m tests/renderer/components/AmbientBackground.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 55[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/MediaDisplay.extra.test.ts[2m > [22m[2mMediaDisplay Extra Coverage[2m > [22m[2mhandles error states in template
[22m[39m[Vue warn]: Invalid watch source:  { value: { path: [32m'bad.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: [33mfalse[39m } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid watch source:  { value: { path: [32m'bad.mp4'[39m } } A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <VideoPlayer ref="videoPlayerRef" key="bad.mp4-video" src="http://localhost/media/bad.mp4"  ... >
  at <Transition key=0 name="media-fade" mode="out-in" >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>
[Vue warn]: Invalid prop: type check failed for prop "isControlsVisible". Expected Boolean, got Object
  at <MediaControls ref="mediaControlsRef" class="floating-controls" current-media-item= { value: { path: [32m'bad.mp4'[39m } }  ... >
  at <MediaDisplay ref="VTU_COMPONENT" >
  at <VTUROOT>

 [32mâœ“[39m tests/renderer/components/MediaDisplay.extra.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 73[2mms[22m[39m
 [32mâœ“[39m tests/components/MediaControls.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 62[2mms[22m[39m
 [32mâœ“[39m tests/server/server.thumbnail-security.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 79[2mms[22m[39m
AggregateError:
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000
    },
    Error: connect ECONNREFUSED 127.0.0.1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000
    }
  ]
}
AggregateError:
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000
    },
    Error: connect ECONNREFUSED 127.0.0.1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000
    }
  ]
}
AggregateError:
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000
    },
    Error: connect ECONNREFUSED 127.0.0.1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000
    }
  ]
}
[90mstderr[2m | tests/renderer/composables/useSlideshow.coverage.test.ts[2m > [22m[2museSlideshow additional coverage[2m > [22m[2mAdditional function coverage[2m > [22m[2mtruncates displayedMediaFiles history
[22m[39mError recording media view: DOMException [NetworkError]: Failed to execute "fetch()" on "Window" with URL "http://localhost:3000/api/media/view":
    at Fetch.onError [90m(file:///app/[39mnode_modules/[4mhappy-dom[24m/lib/fetch/Fetch.js:540:21[90m)[39m
[90m    at ClientRequest.emit (node:events:531:35)[39m
[90m    at emitErrorEvent (node:_http_client:107:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:574:5)[39m
[90m    at Socket.emit (node:events:519:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:90:21)[39m

AggregateError:
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7) {
  code: 'ECONNREFUSED',
  [errors]: [
    Error: connect ECONNREFUSED ::1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000
    },
    Error: connect ECONNREFUSED 127.0.0.1:3000
        at createConnectionError (node:net:1678:14)
        at afterConnectMultiple (node:net:1708:16) {
      errno: -111,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000
    }
  ]
}
 [32mâœ“[39m tests/renderer/composables/useSlideshow.coverage.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 51[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumsList.empty.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 56[2mms[22m[39m
 [32mâœ“[39m tests/server/server.csp.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 66[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/VRVideoPlayer.a11y.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumsList.a11y.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 69[2mms[22m[39m
[90mstderr[2m | tests/core/thumbnail-handler.test.ts[2m > [22m[2mthumbnail-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mhandles ffmpeg failure (non-zero exit)
[22m[39m[Thumbnail] Generation failed: Error: FFmpeg failed with code 1: Error
    at runFFmpegThumbnail [90m(/app/[39msrc/core/thumbnail-handler.ts:31:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36

[90mstderr[2m | tests/core/thumbnail-handler.test.ts[2m > [22m[2mthumbnail-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mhandles runFFmpeg error (e.g. timeout)
[22m[39m[Thumbnail] Generation failed: Error: Process timed out
    at [90m/app/[39mtests/core/thumbnail-handler.test.ts:306:39
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/thumbnail-handler.test.ts[2m > [22m[2mthumbnail-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mhandles cache stream error
[22m[39m[Thumbnail] Cache Stream Error for /cache/thumb.jpg (falling back to generate): Error: Cache read failed
    at [90m/app/[39mtests/core/thumbnail-handler.test.ts:355:32
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/thumbnail-handler.test.ts[2m > [22m[2mthumbnail-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mhandles stream error during sending generated file
[22m[39m[Thumbnail] Stream error sending generated file: Error: Stream error
    at [90m/app/[39mtests/core/thumbnail-handler.test.ts:389:32
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/core/thumbnail-handler.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 50[2mms[22m[39m
[90mstdout[2m | tests/core/media-service.test.ts[2m > [22m[2mmedia-service[2m > [22m[2mscanDiskForAlbumsAndCache[2m > [22m[2muses correct worker path in production web server
[22m[39m[scan-worker] Worker initialized successfully.

[90mstdout[2m | tests/core/media-service.test.ts[2m > [22m[2mmedia-service[2m > [22m[2mscanDiskForAlbumsAndCache[2m > [22m[2muses correct worker path in production web server
[22m[39m[scan-worker] Worker terminated.

 [32mâœ“[39m tests/core/media-service.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 53[2mms[22m[39m
[90mstderr[2m | tests/core/media-service-recursion.test.ts[2m > [22m[2mmedia-service recursion[2m > [22m[2mscanDiskForAlbumsAndCache recursion[2m > [22m[2mshould extract metadata for nested files
[22m[39m[media-service] Error extracting metadata for /child/video.mp4: TypeError: Cannot read properties of undefined (reading 'size')
    at [90m/app/[39msrc/core/media-service.ts:348:25
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:394:36

 [32mâœ“[39m tests/core/media-service-recursion.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 59[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.coverage.test.ts[2m > [22m[2mmedia-handler coverage[2m > [22m[2mserveTranscodedStream handles spawn error and request close
[22m[39m[Transcode] Spawn Error: Error: spawn failed
    at [90m/app/[39mtests/core/media-handler.coverage.test.ts:156:34
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.coverage.test.ts[2m > [22m[2mmedia-handler coverage[2m > [22m[2mserveHeatmap handles generation errors
[22m[39m[Heatmap] Error generating heatmap: Error: fail
    at [90m/app/[39mtests/core/media-handler.coverage.test.ts:245:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/media-handler.coverage.test.ts[2m > [22m[2mmedia-handler coverage[2m > [22m[2mserveStaticFile responds 403 for denied local paths
[22m[39m[ServeStatic] Access denied during re-validation: Access denied

[90mstderr[2m | tests/core/media-handler.coverage.test.ts[2m > [22m[2mmedia-handler coverage[2m > [22m[2mgenerateFileUrl returns error on provider failure
[22m[39m[media-handler] Error processing /file.mp4 in generateFileUrl: Error: boom
    at [90m/app/[39mtests/core/media-handler.coverage.test.ts:416:46
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-handler.coverage.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses existing certificates
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses existing certificates
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap respects PORT environment variable
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap respects PORT environment variable
[22m[39mServer running at https://127.0.0.1:4000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (invalid)
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (invalid)
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (0)
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (0)
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (-1)
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (-1)
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (65536)
[22m[39mSSL Certificates found.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap uses default port when PORT is invalid (65536)
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap generates certificates when missing
[22m[39mGenerating SSL Certificates...

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap generates certificates when missing
[22m[39mSSL Certificates generated successfully.

[90mstdout[2m | tests/server/entry.coverage.test.ts[2m > [22m[2mServer entry coverage[2m > [22m[2mbootstrap generates certificates when missing
[22m[39mServer running at https://127.0.0.1:3000
Environment: Development

 [32mâœ“[39m tests/server/entry.coverage.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 54[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/FileExplorer.a11y.test.ts[2m > [22m[2mFileExplorer.a11y.test.ts[2m > [22m[2mrenders loading state with accessibility attributes
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.a11y.test.ts[2m > [22m[2mFileExplorer.a11y.test.ts[2m > [22m[2mrenders error state with accessibility attributes
[22m[39m[FileExplorer] loadDirectory mode=local path='/error'

 [32mâœ“[39m tests/renderer/components/FileExplorer.a11y.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaDisplay.style.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 69[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/VRVideoPlayer.visibility.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mstarts a new session correctly
[22m[39m[HLS] Starting session session1 for /path/to/movie.mp4

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mstops session and cleans up resources
[22m[39m[HLS] Starting session session2 for /path/to/movie.mp4

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mcleans up inactive sessions after timeout
[22m[39m[HLS] Starting session session3 for /path/to/movie.mp4

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mcleans up inactive sessions after timeout
[22m[39m[HLS] Cleaning up inactive session session3

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mupdates last access time on touch
[22m[39m[HLS] Starting session session4 for /path/to/movie.mp4

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mupdates last access time on touch
[22m[39m[HLS] Cleaning up inactive session session4

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mhandles ffmpeg spawn error
[22m[39m[HLS] Starting session error-spawn for /path

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mhandles ffmpeg non-zero exit code
[22m[39m[HLS] Starting session error-exit for /path

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mstopSession handles already killed process
[22m[39m[HLS] Starting session killed for /path

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mstopSession handles cleanup error
[22m[39m[HLS] Starting session cleanup-error for /path

[90mstdout[2m | tests/core/hls-manager.test.ts[2m > [22m[2mHlsManager[2m > [22m[2mensureSession updates lastAccess if session exists
[22m[39m[HLS] Starting session exists for /path

 [32mâœ“[39m tests/core/hls-manager.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 35[2mms[22m[39m
[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing audio stream gracefully
[22m[39m[MediaAnalyzer] Generating heatmap for video_only.mp4 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing audio stream gracefully
[22m[39m[MediaAnalyzer] Warning: Zero samples found for video_only.mp4
[MediaAnalyzer] Output sample (last 5 lines): lavfi.signalstats.YDIF=10
lavfi.signalstats.YDIF=20

[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing audio stream gracefully
[22m[39m[MediaAnalyzer] Parsed 2 motion samples and 0 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing video stream gracefully
[22m[39m[MediaAnalyzer] Generating heatmap for audio_only.mp3 with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing video stream gracefully
[22m[39m[MediaAnalyzer] Warning: Zero samples found for audio_only.mp3
[MediaAnalyzer] Output sample (last 5 lines): lavfi.astats.Overall.RMS_level=-20
lavfi.astats.Overall.RMS_level=-15

[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle missing video stream gracefully
[22m[39m[MediaAnalyzer] Parsed 0 motion samples and 2 audio samples.

[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould fail if BOTH streams are missing
[22m[39m[MediaAnalyzer] Generating heatmap for empty.file with 10 points

[90mstderr[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould fail if BOTH streams are missing
[22m[39m[MediaAnalyzer] No streams found for empty.file
[MediaAnalyzer] Probe stderr (from error): [vitest] No "runFFmpeg" export is defined on the "../../../src/core/utils/ffmpeg-utils.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:


[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle partial output lines correctly
[22m[39m[MediaAnalyzer] Generating heatmap for partial.mp4 with 2 points

[90mstderr[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle partial output lines correctly
[22m[39m[MediaAnalyzer] Warning: Zero samples found for partial.mp4
[MediaAnalyzer] Output sample (last 5 lines): lavfi.signalstats.YDIF=10
lavfi.signalstats.YDIF=20

[90mstdout[2m | tests/core/analysis/media-analyzer.robustness.test.ts[2m > [22m[2mMediaAnalyzer Robustness[2m > [22m[2mshould handle partial output lines correctly
[22m[39m[MediaAnalyzer] Parsed 2 motion samples and 0 audio samples.

 [32mâœ“[39m tests/core/analysis/media-analyzer.robustness.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 52[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/SourcesModal.a11y.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstderr[2m | tests/renderer/api/WebAdapter.test.ts[2m > [22m[2mWebAdapter[2m > [22m[2mImplementation Details[2m > [22m[2mgetMetadata returns empty object on error
[22m[39mFailed to fetch metadata batch: Error: Network error
    at [90m/app/[39mtests/renderer/api/WebAdapter.test.ts:151:35
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/api/WebAdapter.test.ts[2m > [22m[2mWebAdapter[2m > [22m[2mImplementation Details[2m > [22m[2mgetSmartPlaylists returns empty array on error
[22m[39mFailed to fetch smart playlists: Error: Network error
    at [90m/app/[39mtests/renderer/api/WebAdapter.test.ts:158:35
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/renderer/api/WebAdapter.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 68[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/VRVideoPlayer.orientation.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 54[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/system-controller.test.ts[2m > [22m[2msystem-controller[2m > [22m[2mADD_MEDIA_DIRECTORY[2m > [22m[2mreturns null if addMediaDirectory fails
[22m[39mFailed to add directory by path Error: DB Error
    at [90m/app/[39mtests/main/ipc/system-controller.test.ts:95:53
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/main/ipc/system-controller.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/core/security.test.ts[2m > [22m[2mSecurity Config Loading[2m > [22m[2mloads custom sensitive directories from a valid config file
[22m[39m[Security] Loaded 1 custom sensitive directories.

[90mstdout[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[local-server.js] Local media server started on http://localhost:40285

 [32mâœ“[39m tests/core/security.test.ts [2m([22m[2m59 tests[22m[2m)[22m[32m 41[2mms[22m[39m
[90mstderr[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[Security] Access denied to file outside media directories: (resolved from /tmp/test%file.mp4)

[90mstdout[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[local-server.js] Local media server stopped.

 [32mâœ“[39m tests/main/local-server.encoding.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 45[2mms[22m[39m
 [32mâœ“[39m tests/core/database.coverage.test.ts [2m([22m[2m55 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/LoadingMask.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if gdrive duration missing
[22m[39m[MediaController] Error getting video metadata: Error: Duration not available
    at [90m/app/[39msrc/main/ipc/media-controller.ts:80:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if getVideoDuration returns error
[22m[39m[MediaController] Error getting video metadata: Error: Fail
    at [90m/app/[39msrc/main/ipc/media-controller.ts:91:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/main/ipc/media-controller.test.ts:185:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mDRIVE_GET_PARENT[2m > [22m[2mreturns null on error
[22m[39mFailed to get drive parent Error: Fail
    at [90m/app/[39mtests/main/ipc/media-controller.test.ts:262:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/main/ipc/media-controller.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 37[2mms[22m[39m
 [32mâœ“[39m tests/core/file-system.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mstart()[2m > [22m[2mstarts server and resolves
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mgetUrlForFile starts server if needed and returns url with token
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mRequest Handling[2m > [22m[2mhandles request processing error (with valid token)
[22m[39m[InternalProxy] Request Error: Error: API Fail
    at [90m/app/[39mtests/core/media-proxy.test.ts:152:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mRequest Handling[2m > [22m[2mhandles stream errors (with valid token)
[22m[39m[InternalProxy] Stream Error: Error: Stream failed
    at [90m/app/[39mtests/core/media-proxy.test.ts:311:23
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mgetUrlForFile returns cached port if listening
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mstart() is idempotent
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mdoes not send error response if headers already sent
[22m[39m[InternalProxy] Request Error: Error: Fail after headers
    at [90m/app/[39mtests/core/media-proxy.test.ts:380:48
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-proxy.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 39[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.smart-playlist-optimization.test.ts
[22m[39m[database-worker.js] Worker thread started and ready.

[90mstdout[2m | tests/core/database-worker.smart-playlist-optimization.test.ts[2m > [22m[2mDatabase Worker Optimization[2m > [22m[2mexecuteSmartPlaylist should NOT return heavy fields (watched_segments, size, created_at)
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.smart-playlist-optimization.test.ts[2m > [22m[2mDatabase Worker Optimization[2m > [22m[2mexecuteSmartPlaylist should NOT return heavy fields (watched_segments, size, created_at)
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/database-worker.smart-playlist-optimization.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | tests/core/smart-playlist.test.ts[2m > [22m[2mSmart Playlist SQL Generation
[22m[39m[worker] SQLite database initialized at: /app/tests/core/test_smart_playlist.sqlite

[90mstdout[2m | tests/core/smart-playlist.test.ts[2m > [22m[2mSmart Playlist SQL Generation
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/smart-playlist.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 43[2mms[22m[39m
 [32mâœ“[39m tests/main/database.error.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/TranscodingStatus.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 33[2mms[22m[39m
[90mstderr[2m | tests/core/media-source.test.ts[2m > [22m[2mmedia-source[2m > [22m[2mDriveMediaSource[2m > [22m[2mgetFFmpegInput handles metadata error gracefully
[22m[39mFailed to resolve extension for Drive file input Error: Fetch failed
    at [90m/app/[39mtests/core/media-source.test.ts:187:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-source.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mâœ“[39m tests/renderer/api/ElectronAdapter.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstderr[2m | tests/server/rate-limiter.test.ts[2m > [22m[2mcreateRateLimiter[2m > [22m[2mshould block requests over limit
[22m[39m[Security] Rate limit exceeded for GET /test from 127.0.0.1

 [32mâœ“[39m tests/server/rate-limiter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mstarts the server on the specified port
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mdoes not restart if already running
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mdoes not restart if already running
[22m[39m[AuthServer] Server already running.

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles /auth/google/callback route
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles /auth/google/callback route without code
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mreturns 404 for other routes
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mstops the server
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles server error event
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstderr[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles server error event
[22m[39m[AuthServer] Error: Error: EADDRINUSE
    at [90m/app/[39mtests/main/auth-server.test.ts:197:21
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mescapes HTML in the code parameter
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles request with undefined url
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

 [32mâœ“[39m tests/main/auth-server.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 34[2mms[22m[39m
 [32mâœ“[39m tests/main/database-paths.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/icons/VlcIcon.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 30[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/async-utils.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/core/scan-worker.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/core/worker-client.test.ts[2m > [22m[2mWorkerClient Coverage[2m > [22m[2minit() terminates existing worker before re-initializing
[22m[39m[Worker] Terminating existing worker before re-init.

[90mstdout[2m | tests/core/worker-client.test.ts[2m > [22m[2mWorkerClient Coverage[2m > [22m[2mAuto-Restart[2m > [22m[2mshould auto-restart on unexpected exit
[22m[39m[Worker] Attempting restart 1/5 in 100ms...

[90mstdout[2m | tests/core/worker-client.test.ts[2m > [22m[2mWorkerClient Coverage[2m > [22m[2mAuto-Restart[2m > [22m[2mshould respect maxRestarts
[22m[39m[Worker] Attempting restart 1/2 in 50ms...

[90mstdout[2m | tests/core/worker-client.test.ts[2m > [22m[2mWorkerClient Coverage[2m > [22m[2mAuto-Restart[2m > [22m[2mshould respect maxRestarts
[22m[39m[Worker] Attempting restart 2/2 in 50ms...

 [32mâœ“[39m tests/core/worker-client.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 22[2mms[22m[39m
[90mstderr[2m | tests/main/google-auth.test.ts[2m > [22m[2mGoogle Auth Service[2m > [22m[2mloadSavedCredentialsIfExist[2m > [22m[2mshould return false on database error
[22m[39mFailed to load credentials from DB: Error: DB Error
    at [90m/app/[39mtests/main/google-auth.test.ts:82:56
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/main/google-auth.test.ts[2m > [22m[2mGoogle Auth Service[2m > [22m[2msaveCredentials[2m > [22m[2mshould propagate database errors
[22m[39mFailed to save credentials to DB: Error: Write fail
    at [90m/app/[39mtests/main/google-auth.test.ts:103:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/main/google-auth.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block .env variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.env

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block .env variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.env.local

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block .env variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.env.production

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block .env variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.env.backup

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block .env variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.env.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_rsa

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_rsa.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_rsa.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_dsa

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_dsa.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_dsa.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ecdsa

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ecdsa.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ecdsa.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ed25519

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ed25519.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block SSH private key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/id_ed25519.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.key

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.key.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.crt

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.crt.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.cert

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Server Certificate/Key variants
[22m[39m[Security] Access denied to sensitive file: /allowed/server.cert.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/Dockerfile

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/Dockerfile.dev

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/Dockerfile.prod

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/docker-compose.yml

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/docker-compose.override.yml

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Docker file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/docker-compose.v2.yml

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/package.json

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/package.json.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/package-lock.json

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/yarn.lock

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/yarn.lock.old

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/pnpm-lock.yaml

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.npmrc

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Package Manager file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.npmrc.backup

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.bash_history

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.bash_history.1

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.zsh_history

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.bashrc

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.bashrc.save

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.profile

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block Shell History/Config variants
[22m[39m[Security] Access denied to sensitive file: /allowed/.profile.bak

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block System file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/NTUSER.DAT

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block System file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/ntuser.dat.LOG1

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block System file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/boot.ini

[90mstderr[2m | tests/core/security-variations.test.ts[2m > [22m[2mauthorizeFilePath Extension Security[2m > [22m[2mshould block System file variants
[22m[39m[Security] Access denied to sensitive file: /allowed/boot.ini.bak

 [32mâœ“[39m tests/core/security-variations.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mâœ“[39m tests/core/hls-handler.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstderr[2m | tests/core/drive-stream.test.ts[2m > [22m[2mdrive-stream unit tests[2m > [22m[2mfalls back to drive metadata and stream on cache error
[22m[39mDrive Cache/Fetch failed Error: Cache missing
    at [90m/app/[39mtests/core/drive-stream.test.ts:125:45
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/drive-stream.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/ffmpeg-utils.timeout.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.security.test.ts[2m > [22m[2mmedia-handler security[2m > [22m[2mprevents file enumeration in serveStaticFile via handler
[22m[39m[ServeStatic] Error: Error: Access denied: File does not exist.
    at [90m/app/[39mtests/core/media-handler.security.test.ts:90:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at Module.serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:446:20[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/core/media-handler.security.test.ts:93:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.security.test.ts[2m > [22m[2mmedia-handler security[2m > [22m[2mprevents unauthorized access in serveStaticFile even if validateFileAccess passes
[22m[39m[ServeStatic] Access denied during re-validation: Access denied (path sanitization)

 [32mâœ“[39m tests/core/media-handler.security.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 18[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.optimization.test.ts[2m > [22m[2mDatabase Worker Optimization[2m > [22m[2mshould verify behavior of executeSmartPlaylist regarding ghost files
[22m[39m[worker] SQLite database initialized at: :memory:

[90mstdout[2m | tests/core/database-worker.optimization.test.ts[2m > [22m[2mDatabase Worker Optimization[2m > [22m[2mshould verify behavior of executeSmartPlaylist regarding ghost files
[22m[39m[worker] Database connection closed.

 [32mâœ“[39m tests/core/database-worker.optimization.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/core/providers/local-provider.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.branches.test.ts[2m > [22m[2mMediaHandler Branch Coverage[2m > [22m[2mhandleStreamRequest[2m > [22m[2mshould handle internal errors gracefully
[22m[39m[Handler] Stream failed: Error: Unexpected crash
    at [90m/app/[39mtests/core/media-handler.branches.test.ts:57:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-handler.branches.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useLibraryStore.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/auth-controller.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/main/media-service.coverage.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/database-controller.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/core/media-handler.input.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/renderer/utils/albumUtils.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/media-controller.ffmpeg.test.ts[2m > [22m[2mmedia-controller (ffmpeg missing)[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if ffmpeg missing for local file
[22m[39m[MediaController] Error getting video metadata: Error: FFmpeg binary not found
    at [90m/app/[39msrc/main/ipc/media-controller.ts:87:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/main/ipc/media-controller.ffmpeg.test.ts:61:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/ipc/media-controller.ffmpeg.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mperformFullMediaScan logs error in non-test env
[22m[39m[media-scanner.js] Starting disk scan in directories: [ [32m'/bad/dir'[39m ]

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mperformFullMediaScan logs error in non-test env
[22m[39m[media-scanner.js] Found 0 root albums with 0 total files.

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mscanDirectoryRecursive logs error in non-test env
[22m[39m[media-scanner.js] Starting disk scan in directories: [ [32m'/base'[39m ]

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mscanDirectoryRecursive logs error in non-test env
[22m[39m[media-scanner.js] Found 0 root albums with 0 total files.

 [32mâœ“[39m tests/main/media-scanner.coverage.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstderr[2m | tests/core/access-validator.test.ts[2m > [22m[2maccess-validator unit tests[2m > [22m[2mhandles auth error
[22m[39m[Access] Validation error: Error: Auth failed
    at [90m/app/[39mtests/core/access-validator.test.ts:59:45
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.CCmnQaNT.js:142:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/access-validator.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/renderer/api/index.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/core/providers/drive-provider.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/core/hls-dos.test.ts[2m > [22m[2mHlsManager DOS Protection[2m > [22m[2menforces max concurrent sessions limit (DOS PREVENTION)
[22m[39m[HLS] Starting session session-0 for /path/file-0.mp4

[90mstdout[2m | tests/core/hls-dos.test.ts[2m > [22m[2mHlsManager DOS Protection[2m > [22m[2menforces max concurrent sessions limit (DOS PREVENTION)
[22m[39m[HLS] Starting session session-1 for /path/file-1.mp4

[90mstdout[2m | tests/core/hls-dos.test.ts[2m > [22m[2mHlsManager DOS Protection[2m > [22m[2menforces max concurrent sessions limit (DOS PREVENTION)
[22m[39m[HLS] Starting session session-2 for /path/file-2.mp4

[90mstderr[2m | tests/core/hls-dos.test.ts[2m > [22m[2mHlsManager DOS Protection[2m > [22m[2menforces max concurrent sessions limit (DOS PREVENTION)
[22m[39m[HLS] Session blocked due to concurrency limit (3/3)

 [32mâœ“[39m tests/core/hls-dos.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/main/media-scanner.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/system-controller.security.test.ts[2m > [22m[2msystem-controller security[2m > [22m[2mADD_MEDIA_DIRECTORY[2m > [22m[2mblocks sensitive directories
[22m[39m[Security] Blocked attempt to add sensitive directory: /sensitive/root (resolved to /sensitive/root)

[90mstderr[2m | tests/main/ipc/system-controller.security.test.ts[2m > [22m[2msystem-controller security[2m > [22m[2mLIST_DIRECTORY[2m > [22m[2mblocks restricted paths
[22m[39m[Security] Blocked attempt to list restricted directory: /restricted/path

 [32mâœ“[39m tests/main/ipc/system-controller.security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/ffmpeg-utils.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/renderer/utils/selectionUtils.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/core/smart-playlist-validation.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/concurrency-limiter.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/usePlayerStore.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/core/database-schema-compat.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/ffmpeg-utils.params.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useLibraryStore.recently-played.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/vlc-paths.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/core/media-utils.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m tests/core/media-utils.mime.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/core/media-scanner.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/core/media-service-optimization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m tests/main/media-scanner.errors.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/media-controller.recently-played.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstderr[2m | tests/main/main.ipc.test.ts[2m > [22m[2mMedia Controller IPC Handlers[2m > [22m[2mshould return a generic error for a non-existent file (security)
[22m[39m[Security] Access denied to file outside media directories: (resolved from /path/to/nothing.txt)

 [32mâœ“[39m tests/main/main.ipc.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/main/database.env.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/main/google-secrets.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/main/constants.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/renderer/utils/timeUtils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/core/media-service.performance.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/http-utils.range.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/ffmpeg-utils.streams.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/media-controller.security.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/ffmpeg-utils.duration.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useUIStore.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m tests/core/utils/http-utils.query.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m tests/core/security-generate-file-url.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m tests/core/media-utils.security.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32mâœ“[39m tests/core/media-service-mutation.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 5[2mms[22m[39m

[2m Test Files [22m [1m[32m167 passed[39m[22m[90m (167)[39m
[2m      Tests [22m [1m[32m1636 passed[39m[22m[90m (1636)[39m
[2m   Start at [22m 22:42:10
[2m   Duration [22m 69.26s[2m (transform 7.63s, setup 2.54s, import 76.78s, tests 27.43s, environment 66.40s)[22m
