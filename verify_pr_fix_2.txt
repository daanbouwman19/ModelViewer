
> mediaplayer-app@1.0.4 verify
> npm run format && npm run lint && npm run typecheck && npm run test:coverage


> mediaplayer-app@1.0.4 format
> prettier --write .

__mocks__/worker_threads.js 153ms (unchanged)
.devcontainer/devcontainer.json 12ms (unchanged)
.devcontainer/docker-compose.yml 69ms (unchanged)
.gemini/config.yaml 14ms (unchanged)
.github/dependabot.yml 14ms (unchanged)
.github/workflows/ci.yml 48ms (unchanged)
.github/workflows/release.yml 54ms (unchanged)
.Jules/bolt.md 44ms (unchanged)
.Jules/palette.md 47ms (unchanged)
.Jules/sentinel.md 26ms (unchanged)
.prettierrc.json 5ms (unchanged)
AGENTS.md 16ms (unchanged)
docker-compose.yml 5ms (unchanged)
electron.vite.config.ts 203ms (unchanged)
eslint.config.js 10ms (unchanged)
index.html 79ms (unchanged)
package.json 6ms (unchanged)
playwright.config.ts 11ms (unchanged)
README.md 82ms (unchanged)
src/core/constants.ts 43ms (unchanged)
src/core/database-worker.ts 424ms (unchanged)
src/core/database.ts 69ms (unchanged)
src/core/drive-stream.ts 10ms (unchanged)
src/core/file-system.ts 15ms (unchanged)
src/core/fs-provider-factory.ts 3ms (unchanged)
src/core/fs-provider.ts 8ms (unchanged)
src/core/media-handler-types.ts 4ms (unchanged)
src/core/media-handler.ts 72ms (unchanged)
src/core/media-proxy.ts 25ms (unchanged)
src/core/media-scanner.ts 42ms (unchanged)
src/core/media-service.ts 18ms (unchanged)
src/core/media-source-types.ts 3ms (unchanged)
src/core/media-source.ts 14ms (unchanged)
src/core/media-utils.ts 8ms (unchanged)
src/core/providers/drive-provider.ts 8ms (unchanged)
src/core/providers/local-provider.ts 7ms (unchanged)
src/core/security.ts 6ms (unchanged)
src/core/types.ts 5ms (unchanged)
src/main/auth-server.ts 9ms (unchanged)
src/main/database-worker.ts 2ms (unchanged)
src/main/database.ts 6ms (unchanged)
src/main/drive-cache-manager.ts 21ms (unchanged)
src/main/google-auth.ts 28ms (unchanged)
src/main/google-drive-service.ts 44ms (unchanged)
src/main/google-secrets.ts 3ms (unchanged)
src/main/ipc/auth-controller.ts 10ms (unchanged)
src/main/ipc/database-controller.ts 7ms (unchanged)
src/main/ipc/media-controller.ts 12ms (unchanged)
src/main/ipc/system-controller.ts 16ms (unchanged)
src/main/local-server.ts 9ms (unchanged)
src/main/main.ts 14ms (unchanged)
src/main/utils/ipc-helper.ts 8ms (unchanged)
src/main/utils/security-utils.ts 6ms (unchanged)
src/preload/preload.ts 29ms (unchanged)
src/renderer/api/ElectronAdapter.ts 25ms (unchanged)
src/renderer/api/index.ts 3ms (unchanged)
src/renderer/api/types.ts 9ms (unchanged)
src/renderer/api/WebAdapter.ts 37ms (unchanged)
src/renderer/App.vue 93ms (unchanged)
src/renderer/assets/main.css 35ms (unchanged)
src/renderer/components/AlbumsList.vue 92ms (unchanged)
src/renderer/components/AlbumTree.vue 50ms (unchanged)
src/renderer/components/AmbientBackground.vue 26ms (unchanged)
src/renderer/components/FileExplorer.vue 67ms (unchanged)
src/renderer/components/icons/CloseIcon.vue 2ms (unchanged)
src/renderer/components/icons/DeleteIcon.vue 2ms (unchanged)
src/renderer/components/icons/EditIcon.vue 2ms (unchanged)
src/renderer/components/icons/GridIcon.vue 2ms (unchanged)
src/renderer/components/icons/MenuIcon.vue 2ms (unchanged)
src/renderer/components/icons/PauseIcon.vue 2ms (unchanged)
src/renderer/components/icons/PlayIcon.vue 2ms (unchanged)
src/renderer/components/icons/PlaylistAddIcon.vue 2ms (unchanged)
src/renderer/components/icons/PlaylistIcon.vue 1ms (unchanged)
src/renderer/components/icons/SettingsIcon.vue 2ms (unchanged)
src/renderer/components/icons/SlideshowIcon.vue 2ms (unchanged)
src/renderer/components/icons/StarIcon.vue 2ms (unchanged)
src/renderer/components/icons/VlcIcon.vue 3ms (unchanged)
src/renderer/components/LoadingMask.vue 9ms (unchanged)
src/renderer/components/MediaDisplay.vue 180ms (unchanged)
src/renderer/components/MediaGrid.vue 57ms (unchanged)
src/renderer/components/SmartPlaylistModal.vue 35ms (unchanged)
src/renderer/components/SourcesModal.vue 81ms (unchanged)
src/renderer/composables/useAppState.ts 24ms (unchanged)
src/renderer/composables/useSlideshow.ts 45ms (unchanged)
src/renderer/env.d.ts 14ms (unchanged)
src/renderer/renderer.ts 3ms (unchanged)
src/renderer/utils/albumUtils.ts 31ms (unchanged)
src/renderer/utils/colorExtractor.ts 2ms (unchanged)
src/server/server.ts 101ms (unchanged)
src/shared/ipc-channels.ts 3ms (unchanged)
tests/core/database-worker.test.ts 66ms (unchanged)
tests/core/database.coverage.test.ts 20ms (unchanged)
tests/core/drive-stream.test.ts 14ms (unchanged)
tests/core/file-system.test.ts 14ms (unchanged)
tests/core/media-handler.security.test.ts 11ms (unchanged)
tests/core/media-handler.test.ts 165ms (unchanged)
tests/core/media-proxy.test.ts 46ms (unchanged)
tests/core/media-service.test.ts 14ms (unchanged)
tests/core/media-source.test.ts 23ms (unchanged)
tests/core/providers/drive-provider.test.ts 12ms (unchanged)
tests/core/providers/local-provider.test.ts 12ms (unchanged)
tests/core/security.test.ts 5ms (unchanged)
tests/core/thumbnail-generation.integration.test.ts 9ms (unchanged)
tests/e2e/app-sanity.spec.ts 7ms (unchanged)
tests/e2e/visual.spec.ts 10ms (unchanged)
tests/main/auth-server.test.ts 30ms (unchanged)
tests/main/constants.test.ts 6ms (unchanged)
tests/main/database-paths.test.ts 17ms (unchanged)
tests/main/database.env.test.ts 4ms (unchanged)
tests/main/database.error.test.ts 9ms (unchanged)
tests/main/database.test.ts 73ms (unchanged)
tests/main/drive-cache-manager.test.ts 48ms (unchanged)
tests/main/google-auth.test.ts 35ms (unchanged)
tests/main/google-drive-service.coverage.test.ts 26ms (unchanged)
tests/main/google-drive-service.test.ts 39ms (unchanged)
tests/main/google-secrets.test.ts 5ms (unchanged)
tests/main/ipc/auth-controller.test.ts 15ms (unchanged)
tests/main/ipc/database-controller.test.ts 14ms (unchanged)
tests/main/ipc/media-controller.ffmpeg.test.ts 8ms (unchanged)
tests/main/ipc/media-controller.test.ts 21ms (unchanged)
tests/main/ipc/system-controller.test.ts 21ms (unchanged)
tests/main/local-server.encoding.test.ts 16ms (unchanged)
tests/main/local-server.test.ts 66ms (unchanged)
tests/main/main.ipc-security.test.ts 16ms (unchanged)
tests/main/main.ipc.test.ts 8ms (unchanged)
tests/main/media-scanner.coverage.test.ts 8ms (unchanged)
tests/main/media-scanner.errors.test.ts 7ms (unchanged)
tests/main/media-scanner.test.ts 14ms (unchanged)
tests/main/media-service.coverage.test.ts 9ms (unchanged)
tests/main/mocks/electron.ts 3ms (unchanged)
tests/main/security.test.ts 17ms (unchanged)
tests/main/vlc.security.test.ts 14ms (unchanged)
tests/main/vlc.test.ts 23ms (unchanged)
tests/renderer/api/backend.contract.ts 28ms (unchanged)
tests/renderer/api/ElectronAdapter.test.ts 10ms (unchanged)
tests/renderer/api/index.test.ts 3ms (unchanged)
tests/renderer/api/WebAdapter.test.ts 9ms (unchanged)
tests/renderer/components/AlbumsList.coverage.test.ts 21ms (unchanged)
tests/renderer/components/AlbumsList.test.ts 23ms (unchanged)
tests/renderer/components/AlbumTree.test.ts 17ms (unchanged)
tests/renderer/components/AmbientBackground.test.ts 15ms (unchanged)
tests/renderer/components/App.branch.test.ts 19ms (unchanged)
tests/renderer/components/App.test.ts 17ms (unchanged)
tests/renderer/components/FileExplorer.test.ts 51ms (unchanged)
tests/renderer/components/icons/VlcIcon.test.ts 3ms (unchanged)
tests/renderer/components/LoadingMask.test.ts 3ms (unchanged)
tests/renderer/components/MediaDisplay.concurrency.test.ts 13ms (unchanged)
tests/renderer/components/MediaDisplay.coverage.test.ts 13ms (unchanged)
tests/renderer/components/MediaDisplay.test.ts 98ms (unchanged)
tests/renderer/components/MediaDisplayVlc.test.ts 46ms (unchanged)
tests/renderer/components/MediaGrid.coverage.test.ts 35ms (unchanged)
tests/renderer/components/MediaGrid.test.ts 30ms (unchanged)
tests/renderer/components/Palette.a11y.test.ts 27ms (unchanged)
tests/renderer/components/ProgressBars.test.ts 9ms (unchanged)
tests/renderer/components/SmartPlaylistModal.coverage.test.ts 26ms (unchanged)
tests/renderer/components/SmartPlaylistModal.test.ts 18ms (unchanged)
tests/renderer/components/SourcesModal.test.ts 62ms (unchanged)
tests/renderer/composables/useAppState.test.ts 51ms (unchanged)
tests/renderer/composables/useSlideshow.coverage.test.ts 27ms (unchanged)
tests/renderer/composables/useSlideshow.test.ts 59ms (unchanged)
tests/renderer/google-drive.test.ts 13ms (unchanged)
tests/renderer/mocks/electronAPI.ts 8ms (unchanged)
tests/renderer/utils/albumUtils.test.ts 12ms (unchanged)
tests/server/cors.test.ts 9ms (unchanged)
tests/server/server.coverage.test.ts 43ms (unchanged)
tests/server/server.gdrive.test.ts 9ms (unchanged)
tests/server/server.test.ts 47ms (unchanged)
tsconfig.json 2ms (unchanged)
tsconfig.node.json 2ms (unchanged)
tsconfig.web.json 2ms (unchanged)
vite.config.ts 4ms (unchanged)
vitest.config.js 5ms (unchanged)

> mediaplayer-app@1.0.4 lint
> eslint .


> mediaplayer-app@1.0.4 typecheck
> vue-tsc -b --noEmit


> mediaplayer-app@1.0.4 test:coverage
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/app[39m
      [2mCoverage enabled with [22m[33mistanbul[39m

 [32mâœ“[39m tests/core/thumbnail-generation.integration.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 6825[2mms[22m[39m
     [33m[2mâœ“[22m[39m should generate a thumbnail using valid ffmpeg args [33m 6822[2mms[22m[39m
[90mstdout[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould allow access to files within allowed media directories
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/main/main.ipc.test.ts[2m > [22m[2mmain.js IPC Handlers[2m > [22m[2mshould return a generic error for a non-existent file (security)
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m20:35:09.988 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[Security] Access denied to file outside media directories: /etc/passwd (resolved from /etc/passwd)

[90mstderr[2m | tests/main/main.ipc.test.ts[2m > [22m[2mmain.js IPC Handlers[2m > [22m[2mshould return a generic error for a non-existent file (security)
[22m[39m[database.js] Error getting media directories: Error: Database worker not initialized
    at [90m/app/[39msrc/core/database.ts:60:21
    at new Promise (<anonymous>)
    at sendMessageToWorker [90m(/app/[39msrc/core/database.ts:58:10[90m)[39m
    at getMediaDirectories [90m(/app/[39msrc/core/database.ts:334:31[90m)[39m
    at authorizeFilePath [90m(/app/[39msrc/core/security.ts:23:34[90m)[39m
    at generateFileUrl [90m(/app/[39msrc/core/media-handler.ts:505:26[90m)[39m
    at handler [90m(/app/[39msrc/main/ipc/media-controller.ts:39:14[90m)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:21:26
    at [90m/app/[39mtests/main/main.ipc.test.ts:80:26
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/main/main.ipc.test.ts[2m > [22m[2mmain.js IPC Handlers[2m > [22m[2mshould return a generic error for a non-existent file (security)
[22m[39m[Security] File existence check failed for /path/to/nothing.txt: Error: ENOENT
    at [90m/app/[39mtests/main/main.ipc.test.ts:77:7
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny path traversal attempts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny path traversal attempts
[22m[39m20:35:10.021 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny path traversal attempts
[22m[39m[Security] Access denied to file outside media directories: /etc/passwd (resolved from /etc/passwd)

 [32mâœ“[39m tests/main/main.ipc.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 6992[2mms[22m[39m
     [33m[2mâœ“[22m[39m should return a generic error for a non-existent file (security) [33m 6985[2mms[22m[39m
[90mstdout[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny symlink traversal attacks
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny symlink traversal attacks
[22m[39m20:35:10.039 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstderr[2m | tests/main/security.test.ts[2m > [22m[2mSecurity: load-file-as-data-url[2m > [22m[2mshould deny symlink traversal attacks
[22m[39m[Security] Access denied to file outside media directories: /etc/passwd (resolved from /allowed/media/secret_link)

 [32mâœ“[39m tests/main/security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 6541[2mms[22m[39m
     [33m[2mâœ“[22m[39m should allow access to files within allowed media directories [33m 6464[2mms[22m[39m
[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mDevelopment Environment[2m > [22m[2mshould block evil.com origin (by returning mismatched allowed origin)
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mDevelopment Environment[2m > [22m[2mshould block evil.com origin (by returning mismatched allowed origin)
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mDevelopment Environment[2m > [22m[2mshould allow localhost:5173
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mDevelopment Environment[2m > [22m[2mshould allow localhost:5173
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mProduction Environment[2m > [22m[2mshould disable CORS (Same-Origin enforced) by not sending headers
[22m[39mInitializing database at /app/media-library.db using worker /app/src/server/worker.js

[90mstdout[2m | tests/server/cors.test.ts[2m > [22m[2mServer CORS[2m > [22m[2mProduction Environment[2m > [22m[2mshould disable CORS (Same-Origin enforced) by not sending headers
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/cors.test.ts
[22m[39mError: ENOENT: no such file or directory, stat '/app/src/client/index.html'

 [32mâœ“[39m tests/server/cors.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1935[2mms[22m[39m
       [33m[2mâœ“[22m[39m should block evil.com origin (by returning mismatched allowed origin) [33m 1855[2mms[22m[39m
[90mstdout[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny record-media-view for unauthorized file
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny record-media-view for unauthorized file
[22m[39m[IPC] Error on record-media-view: Error: Access denied
    at validatePathAccess [90m(/app/[39msrc/main/utils/security-utils.ts:11:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:18:11
    at [90m/app/[39mtests/main/main.ipc-security.test.ts:97:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould allow record-media-view for authorized file
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould allow record-media-view for authorized file
[22m[39m20:35:12.120 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould allow record-media-view for gdrive file
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould allow record-media-view for gdrive file
[22m[39m20:35:12.142 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould filter unauthorized paths in get-media-view-counts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould filter unauthorized paths in get-media-view-counts
[22m[39m20:35:12.156 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny db:upsert-metadata for unauthorized file
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny db:upsert-metadata for unauthorized file
[22m[39m20:35:12.182 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstderr[2m | tests/main/main.ipc-security.test.ts[2m > [22m[2mmain.js IPC Security[2m > [22m[2mshould deny db:upsert-metadata for unauthorized file
[22m[39m[IPC] Error on db:upsert-metadata: Error: Access denied
    at validatePathAccess [90m(/app/[39msrc/main/utils/security-utils.ts:11:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:18:11
    at [90m/app/[39mtests/main/main.ipc-security.test.ts:155:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/main.ipc-security.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1480[2mms[22m[39m
     [33m[2mâœ“[22m[39m should deny record-media-view for unauthorized file [33m 1398[2mms[22m[39m
[90mstdout[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould return a stream
[22m[39m[GoogleDrive] Stream started for fileId

[90mstdout[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould use Range header if start/end provided
[22m[39m[GoogleDrive] Stream started for fileId

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould be registered
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstderr[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveFileStream[2m > [22m[2mshould retry on 429
[22m[39m[GoogleDrive] Rate limited or server error (429). Retrying in 1000ms...

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould fail if VLC is not found on Windows
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould fail if VLC is not found on Windows
[22m[39m20:35:14.071 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould succeed if VLC is found on Windows
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould succeed if VLC is found on Windows
[22m[39m20:35:14.136 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould attempt to spawn "vlc" on Linux
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould attempt to spawn "vlc" on Linux
[22m[39m20:35:14.208 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould use standard path on macOS if it exists
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould use standard path on macOS if it exists
[22m[39m20:35:14.224 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould fallback to "vlc" on macOS if standard path does not exist
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould fallback to "vlc" on macOS if standard path does not exist
[22m[39m20:35:14.239 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould attach error listener to child process
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould attach error listener to child process
[22m[39m20:35:14.254 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstdout[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould handle synchronous spawn errors
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould handle synchronous spawn errors
[22m[39m20:35:14.269 â€º Error: log.initialize({ preload }) already called
    at initializePreload (/app/node_modules/electron-log/src/main/initialize.js:54:17)
    at /app/node_modules/electron-log/src/main/initialize.js:23:11
    at ElectronExternalApi.onAppReady (/app/node_modules/electron-log/src/main/ElectronExternalApi.js:103:7)
    at Logger.initialize [as initializeFn] (/app/node_modules/electron-log/src/main/initialize.js:20:17)
    at Logger.initialize (/app/node_modules/electron-log/src/core/Logger.js:129:10)
    at /app/src/main/main.ts:14:5
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at VitestModuleEvaluator._runInlinedModule (file:///app/node_modules/vitest/dist/module-evaluator.js:197:4)
    at VitestModuleRunner.directRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1146:59)
    at VitestModuleRunner.cachedRequest (file:///app/node_modules/vite/dist/node/module-runner.js:1053:73)

[90mstderr[2m | tests/main/vlc.test.ts[2m > [22m[2mMain Process IPC - open-in-vlc[2m > [22m[2mshould handle synchronous spawn errors
[22m[39m[media-handler] Error launching VLC: Error: Spawn failed
    at [90m/app/[39mtests/main/vlc.test.ts:268:13
    at spawn [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at openMediaInVlc [90m(/app/[39msrc/core/media-handler.ts:587:19[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39msrc/main/utils/ipc-helper.ts:21:20
    at [90m/app/[39mtests/main/vlc.test.ts:271:20
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/vlc.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2060[2mms[22m[39m
     [33m[2mâœ“[22m[39m should be registered [33m 1785[2mms[22m[39m
[90mstdout[2m | tests/main/vlc.security.test.ts[2m > [22m[2mSecurity: open-in-vlc[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/main/vlc.security.test.ts[2m > [22m[2mSecurity: open-in-vlc[2m > [22m[2mshould deny access to files outside allowed media directories
[22m[39m[Security] Access denied to file outside media directories: /etc/passwd (resolved from /etc/passwd)

 [32mâœ“[39m tests/main/vlc.security.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1884[2mms[22m[39m
     [33m[2mâœ“[22m[39m should deny access to files outside allowed media directories [33m 1882[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.test.ts
[22m[39m[database-worker.js] Worker thread started and ready.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould initialize the database
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-6A8W1K/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould initialize the database
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-2KJrkO/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] Closed existing DB connection before re-init.
[worker] SQLite database initialized at: /app/tests/temp/test-db-2KJrkO/new.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould handle re-initialization
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould close the database
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-if7rfb/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould close the database
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould migrate old media_directories schema
[22m[39m[worker] Migrating media_directories table...
[worker] Migration complete.
[worker] SQLite database initialized at: /app/tests/temp/test-db-S16Hgj/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mInitialization and Basic Operations[2m > [22m[2mshould migrate old media_directories schema
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould record a media view
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-6ccnhT/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould record a media view
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould increment view count
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-3Ll8of/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould increment view count
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould return zero for files with no views
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-iH4BqM/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould return zero for files with no views
[22m[39m[worker] Database connection closed.

[90mstderr[2m | tests/main/google-drive-service.test.ts[2m > [22m[2mGoogle Drive Service[2m > [22m[2mgetDriveParent[2m > [22m[2mshould return null on error
[22m[39mFailed to get parent for drive folder childId Error: API Error
    at [90m/app/[39mtests/main/google-drive-service.test.ts:460:54
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle special characters in file paths
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-2nYeLH/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle special characters in file paths
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle non-existent files (fallback ID generation)
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-yPqHiV/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould handle non-existent files (fallback ID generation)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould generate ID from path for GDrive files
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-1D0WUZ/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Views[2m > [22m[2mshould generate ID from path for GDrive files
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould cache albums
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-MnyR4K/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould cache albums
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould get cached albums
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-4jUWvI/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould get cached albums
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould return null for non-existent cache
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-N5x5Px/test.sqlite

 [32mâœ“[39m tests/main/google-drive-service.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 2023[2mms[22m[39m
       [33m[2mâœ“[22m[39m should retry on 429 [33m 1029[2mms[22m[39m
[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould return null for non-existent cache
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould overwrite existing cache
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-2fCUzf/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mAlbum Caching[2m > [22m[2mshould overwrite existing cache
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (string path)
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-plSfQt/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (string path)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (object payload)
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-KNnacr/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould add a media directory (object payload)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould get media directories
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-fjH3T7/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould get media directories
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould not duplicate directories
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-U3LmdG/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould not duplicate directories
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould re-activate deactivated directories on add
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-OIQEB5/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould re-activate deactivated directories on add
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould remove a media directory
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-99lAzw/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould remove a media directory
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould set directory active state
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-glJ989/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mMedia Directories[2m > [22m[2mshould set directory active state
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould create and retrieve smart playlists
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-C1NWip/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould create and retrieve smart playlists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould update and delete smart playlists
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-JtwWLf/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould update and delete smart playlists
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle metadata and ratings
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-eLKWIp/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle metadata and ratings
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle partial updates (COALESCE logic)
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-cUWUEA/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle partial updates (COALESCE logic)
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-mNiixZ/test.sqlite

[90mstderr[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] Error generating file ID for undefined: Error: File path cannot be null or empty
    at generateFileId [90m(/app/[39msrc/core/database-worker.ts:35:13[90m)[39m
    at upsertMetadata [90m(/app/[39msrc/core/database-worker.ts:293:26[90m)[39m
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/database-worker.ts:738:26[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:87:19
    at new Promise (<anonymous>)
    at sendMessage [90m(/app/[39mtests/core/database-worker.test.ts:65:12[90m)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:454:28
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould fail gracefully when upsertMetadata receives invalid payload
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle setRating message
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-6HA1c0/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle setRating message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getMetadata message
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-2uoFgx/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle getMetadata message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle executeSmartPlaylist message
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-nu4ZSP/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mSmart Playlists & Metadata[2m > [22m[2mshould handle executeSmartPlaylist message
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'recordMediaView' should fail gracefully
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-RhCadZ/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'recordMediaView' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'getMediaViewCounts' should fail gracefully
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-VfG6we/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'getMediaViewCounts' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'addMediaDirectory' should fail gracefully
[22m[39m[worker] SQLite database initialized at: /app/tests/temp/test-db-eTRsnp/test.sqlite

[90mstdout[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mOperations after close[2m > [22m[2m'addMediaDirectory' should fail gracefully
[22m[39m[worker] Database connection closed.

[90mstderr[2m | tests/core/database-worker.test.ts[2m > [22m[2mDatabase Worker[2m > [22m[2mError Handling[2m > [22m[2mshould catch top-level errors in message processing
[22m[39m[worker] Error processing message id=161, type=recordMediaView: TypeError: Cannot read properties of null (reading 'filePath')
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/database-worker.ts:707:50[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:87:19
    at new Promise (<anonymous>)
    at sendMessage [90m(/app/[39mtests/core/database-worker.test.ts:65:12[90m)[39m
    at [90m/app/[39mtests/core/database-worker.test.ts:564:28
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)

 [32mâœ“[39m tests/core/database-worker.test.ts [2m([22m[2m50 tests[22m[2m)[22m[33m 1242[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGrid.coverage.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 949[2mms[22m[39m
     [33m[2mâœ“[22m[39m handles scroll logic (throttled) [33m 306[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/SmartPlaylistModal.coverage.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 539[2mms[22m[39m
     [33m[2mâœ“[22m[39m watcher resets form when modal closes [33m 360[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mgetVideoDuration[2m > [22m[2mhandles ffmpeg spawn error for duration
[22m[39m[Metadata] FFmpeg spawn error: Error: Spawn failed
    at [90m/app/[39mtests/core/media-handler.test.ts:256:30
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveMetadata[2m > [22m[2mreturns 500 if auth check throws
[22m[39m[Metadata] Path validation error: Error: Auth error
    at [90m/app/[39mtests/core/media-handler.test.ts:279:47
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mhandles ffmpeg failure (non-zero exit)
[22m[39m[Thumbnail] Generation failed: Error: FFmpeg failed with code 1:
    at [90m/app/[39msrc/core/media-handler.ts:67:19
    at Object.<anonymous> [90m(/app/[39mtests/core/media-handler.test.ts:668:34[90m)[39m
    at Object.on [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:65:16
    at new Promise (<anonymous>)
    at runFFmpegThumbnail [90m(/app/[39msrc/core/media-handler.ts:45:10[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:352:27
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:290:37
    at PQueue.#tryToStartAnother [90m(file:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:170:17[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4mp-queue[24m/dist/index.js:328:36

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveThumbnail[2m > [22m[2mcollects stderr output
[22m[39m[Thumbnail] Generation failed: Error: FFmpeg failed with code 1: Error output
    at EventEmitter.<anonymous> [90m(/app/[39msrc/core/media-handler.ts:67:19[90m)[39m
[90m    at EventEmitter.emit (node:events:519:28)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:703:19
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveStaticFile[2m > [22m[2mhandles access denied
[22m[39m[ServeStatic] Error: Error: Access denied
    at [90m/app/[39mtests/core/media-handler.test.ts:794:44
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mserveStaticFile[2m > [22m[2mhandles internal errors
[22m[39m[ServeStatic] Error: Error: Boom
    at [90m/app/[39mtests/core/media-handler.test.ts:807:15
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at Module.serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:380:20[90m)[39m
    at [90m/app/[39mtests/core/media-handler.test.ts:809:13
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mcreateMediaRequestHandler[2m > [22m[2mhandlers /video/stream transcode
[22m[39m[Handler] Stream failed: TypeError: input.resume is not a function
[90m    at InterfaceConstructor (node:internal/readline/interface:344:9)[39m
[90m    at new Interface (node:readline:115:3)[39m
[90m    at createInterface (node:readline:212:10)[39m
    at serveTranscodedStream [90m(/app/[39msrc/core/media-handler.ts:266:24[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:444:18
    at [90m/app/[39mtests/core/media-handler.test.ts:891:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mcreateMediaRequestHandler[2m > [22m[2mhandles stream initialization error
[22m[39m[Handler] Stream failed: Error: Error initializing source
    at [90m/app/[39mtests/core/media-handler.test.ts:970:15
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:437:24
    at [90m/app/[39mtests/core/media-handler.test.ts:973:13
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37

[90mstdout[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mcreateMediaRequestHandler[2m > [22m[2mhandles stream access denied
[22m[39mTest: Creating mock media source for access denied

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mcreateMediaRequestHandler[2m > [22m[2mhandles stream access denied
[22m[39m[Handler] Stream failed: Error: Access denied
    at [90m/app/[39mtests/core/media-handler.test.ts:994:46
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:437:24
    at [90m/app/[39mtests/core/media-handler.test.ts:1001:13
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mcreateMediaRequestHandler[2m > [22m[2mhandles process error
[22m[39m[Transcode] Spawn Error: Error: Process Error
    at [90m/app/[39mtests/core/media-handler.test.ts:1062:30
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.test.ts[2m > [22m[2mmedia-handler unit tests[2m > [22m[2mgenerateFileUrl[2m > [22m[2mshould handle fs errors gracefully
[22m[39m[media-handler] Error processing /local/file.mp4 in generateFileUrl: Error: FS Error
    at [90m/app/[39mtests/core/media-handler.test.ts:1127:36
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-handler.test.ts [2m([22m[2m63 tests[22m[2m)[22m[33m 731[2mms[22m[39m
[90mstderr[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mshould handle catch block error
[22m[39mError loading media: Error: Network error
    at [90m/app/[39mtests/renderer/components/MediaDisplay.test.ts:263:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mTranscoding Logic[2m > [22m[2mshould start transcoding when tryTranscoding is called
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mTranscoding Logic[2m > [22m[2mshould handle video loaded metadata for unsupported formats
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mTranscoding Logic[2m > [22m[2mshould show unsupported format overlay and handle transcoding click
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mVideo Controls[2m > [22m[2mshould handle progress bar click in transcoding mode
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mExtended Video Interactions[2m > [22m[2mhandles keyboard navigation on progress bar
[22m[39mTranscoding URL: url?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mshould auto-transcode legacy formats
[22m[39mProactively transcoding legacy format: test.mkv

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mshould auto-transcode legacy formats
[22m[39mTranscoding URL: stream/url?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mshould try transcoding if video dimensions are 0 (HEVC check)
[22m[39mTranscoding URL: stream/url?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mshould try transcoding on media error if not already transcoding
[22m[39mMedia playback error, attempting auto-transcode...

[90mstdout[2m | tests/renderer/components/MediaDisplay.test.ts[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mAdditional Coverage[2m > [22m[2mshould try transcoding on media error if not already transcoding
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

 [32mâœ“[39m tests/renderer/components/MediaDisplay.test.ts [2m([22m[2m48 tests[22m[2m)[22m[33m 500[2mms[22m[39m
[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles invalid_grant
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles invalid_grant
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles invalid_grant
[22m[39m{ message: [32m'invalid_grant'[39m }

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles generic error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles generic error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAuthentication & Auth Error Handling[2m > [22m[2mPOST /api/auth/google-drive/code handles generic error
[22m[39mError: Boom
    at [90m/app/[39mtests/server/server.coverage.test.ts:115:56
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMedia View & Rate Errors[2m > [22m[2mPOST /api/media/view returns 403 if access denied
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMedia View & Rate Errors[2m > [22m[2mPOST /api/media/view returns 403 if access denied
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMedia View & Rate Errors[2m > [22m[2mPOST /api/media/views filters unauthorized paths
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMedia View & Rate Errors[2m > [22m[2mPOST /api/media/views filters unauthorized paths
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream returns 400 if missing file
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream returns 400 if missing file
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles access denied from source creation
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles access denied from source creation
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles access denied from source creation
[22m[39mStream error: Error: Access denied
    at [90m/app/[39mtests/server/server.coverage.test.ts:154:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles generic error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles generic error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/stream handles generic error
[22m[39mStream error: Error: Stream broke
    at [90m/app/[39mtests/server/server.coverage.test.ts:162:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles access denied
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles access denied
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles access denied
[22m[39mServe error: Error: Access denied
    at [90m/app/[39mtests/server/server.coverage.test.ts:170:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles generic error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles generic error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mStreaming & Serving Errors[2m > [22m[2mGET /api/serve handles generic error
[22m[39mServe error: Error: Serve broke
    at [90m/app/[39mtests/server/server.coverage.test.ts:178:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mGET /api/smart-playlists should return lists
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mGET /api/smart-playlists should return lists
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mPOST /api/smart-playlists should handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mPOST /api/smart-playlists should handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mSmart Playlists (Existing)[2m > [22m[2mPOST /api/smart-playlists should handle errors
[22m[39mError: Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:198:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mPOST /api/albums/reindex returns albums
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mPOST /api/albums/reindex returns albums
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /api/auth/google-drive/start returns url
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /api/auth/google-drive/start returns url
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /auth/google/callback returns html
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /auth/google/callback returns html
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /api/drive/files returns list
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional API Routes[2m > [22m[2mGET /api/drive/files returns list
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/parent returns parent path
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/parent returns parent path
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/parent returns null for root
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/parent returns null for root
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/ls returns contents
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/ls returns contents
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/ls handles error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mFile System Routes[2m > [22m[2mGET /api/fs/ls handles error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPOST /api/media/metadata upserts metadata
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPOST /api/media/metadata upserts metadata
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPOST /api/media/metadata/batch retrieves metadata
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPOST /api/media/metadata/batch retrieves metadata
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mDELETE /api/directories removes directory
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mDELETE /api/directories removes directory
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPUT /api/directories/active sets state
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mPUT /api/directories/active sets state
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mGET /api/drive/parent returns parent
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mGET /api/drive/parent returns parent
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mGET /api/drive/parent handles error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mMetadata & Directory Operations[2m > [22m[2mGET /api/drive/parent handles error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mPOST /api/media/metadata handles upsert failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mPOST /api/media/metadata handles upsert failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mPOST /api/media/metadata handles upsert failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:329:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/auth/google-drive/start handles generation failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/auth/google-drive/start handles generation failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/auth/google-drive/start handles generation failure
[22m[39mError: Auth Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:338:15
    at generateAuthUrl [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/server/server.ts:372:19
    at Layer.handleRequest [90m(/app/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/app/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at Route.dispatch [90m(/app/[39mnode_modules/[4mrouter[24m/lib/route.js:117:3[90m)[39m
    at handle [90m(/app/[39mnode_modules/[4mrouter[24m/index.js:435:11[90m)[39m
    at Layer.handleRequest [90m(/app/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at [90m/app/[39mnode_modules/[4mrouter[24m/index.js:295:15
    at processParams [90m(/app/[39mnode_modules/[4mrouter[24m/index.js:582:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/files handles list failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/files handles list failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/files handles list failure
[22m[39mError: List Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:345:54
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/parent handles failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/parent handles failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mError Handling Scenarios[2m > [22m[2mGET /api/drive/parent handles failure
[22m[39mError: Parent Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:353:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles missing args
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles missing args
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles db failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles db failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mPOST /api/media/rate handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:368:55
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/media/all handles db failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/media/all handles db failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mGET /api/media/all handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:384:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles invalid id
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles invalid id
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles db failure
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles db failure
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.coverage.test.ts[2m > [22m[2mServer Coverage[2m > [22m[2mAdditional Error Branches[2m > [22m[2mDELETE /api/smart-playlists/:id handles db failure
[22m[39mError: DB Fail
    at [90m/app/[39mtests/server/server.coverage.test.ts:397:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/server/server.coverage.test.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 432[2mms[22m[39m
[90mstdout[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mlistDriveDirectory handles generic files and shortcuts
[22m[39m[GoogleDrive] listDriveDirectory 'root' found 3 items.

[90mstderr[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mlistDriveDirectory handles error
[22m[39m[GoogleDriveService] Error listing files for query ''root' in parents and trashed = false': Error: List failed
    at [90m/app/[39mtests/main/google-drive-service.coverage.test.ts:172:36
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mgetDriveParent returns parent
[22m[39mFailed to get parent for drive folder child Error: Fail
    at [90m/app/[39mtests/main/google-drive-service.coverage.test.ts:190:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/google-drive-service.coverage.test.ts[2m > [22m[2mGoogle Drive Service Coverage[2m > [22m[2mgetDriveFileStream returns stream
[22m[39m[GoogleDrive] Stream started for id

 [32mâœ“[39m tests/main/google-drive-service.coverage.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 500[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaGrid.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 344[2mms[22m[39m
[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mGET /api/auth/google-drive/start returns URL
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mGET /api/auth/google-drive/start returns URL
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/auth/google-drive/code accepts code
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/auth/google-drive/code accepts code
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/auth/google-drive/code returns 400 if missing code
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/auth/google-drive/code returns 400 if missing code
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/sources/google-drive adds source
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/sources/google-drive adds source
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/sources/google-drive returns 400 if missing id
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.gdrive.test.ts[2m > [22m[2mServer Google Drive Routes[2m > [22m[2mPOST /api/sources/google-drive returns 400 if missing id
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

 [32mâœ“[39m tests/server/server.gdrive.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 294[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AmbientBackground.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 261[2mms[22m[39m
[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/albums[2m > [22m[2mshould return albums
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/albums[2m > [22m[2mshould return albums
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/albums[2m > [22m[2mshould handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/albums[2m > [22m[2mshould handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/albums[2m > [22m[2mshould handle errors
[22m[39mError: Test error
    at [90m/app/[39mtests/server/server.test.ts:69:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/albums/reindex[2m > [22m[2mshould reindex and return albums
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/albums/reindex[2m > [22m[2mshould reindex and return albums
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/albums/reindex[2m > [22m[2mshould handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/albums/reindex[2m > [22m[2mshould handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/albums/reindex[2m > [22m[2mshould handle errors
[22m[39mError: Test error
    at [90m/app/[39mtests/server/server.test.ts:95:27
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould record media view
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould record media view
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould start server and set port
[22m[39m[local-server.js] Local media server started on http://localhost:32785

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould start server and set port
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Local media server started on http://localhost:39313

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Server already started. Ignoring request.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle starting when server already running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould ignore start request if server is already running (callback)
[22m[39m[local-server.js] Local media server started on http://localhost:40979

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould ignore start request if server is already running (callback)
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle start without callback when running
[22m[39m[local-server.js] Local media server started on http://localhost:36117

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstartLocalServer[2m > [22m[2mshould handle start without callback when running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould stop the server
[22m[39m[local-server.js] Local media server started on http://localhost:46351

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould stop the server
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle stop without callback
[22m[39m[local-server.js] Local media server started on http://localhost:42905

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle stop without callback
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould return 400 if filePath is missing
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould return 400 if filePath is missing
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould return 403 if access is denied
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/view[2m > [22m[2mshould return 403 if access is denied
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/views[2m > [22m[2mshould return media view counts
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/views[2m > [22m[2mshould return media view counts
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/views[2m > [22m[2mshould return 400 if filePaths is invalid
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/media/views[2m > [22m[2mshould return 400 if filePaths is invalid
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/directories[2m > [22m[2mshould return directories
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/directories[2m > [22m[2mshould return directories
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould add a directory
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould add a directory
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould return 400 if directory does not exist
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould return 400 if directory does not exist
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPOST /api/directories[2m > [22m[2mshould handle errors
[22m[39mError: Db error
    at [90m/app/[39mtests/server/server.test.ts:207:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould remove a directory
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould remove a directory
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mDELETE /api/directories[2m > [22m[2mshould handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould set directory active state
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould set directory active state
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould return 400 if path is missing
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould handle errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mPUT /api/directories/active[2m > [22m[2mshould handle errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould list directory
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould list directory
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould return 400 if path missing
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould return 400 if path missing
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould handle error
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/ls[2m > [22m[2mshould handle error
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return parent
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mgetServerPort[2m > [22m[2mshould return port when server is running
[22m[39m[local-server.js] Local media server started on http://localhost:35011

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mgetServerPort[2m > [22m[2mshould return port when server is running
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return parent
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve a file successfully
[22m[39m[local-server.js] Local media server started on http://localhost:37999

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return null parent for root
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return null parent for root
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return 400 if missing path
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mGET /api/fs/parent[2m > [22m[2mshould return 400 if missing path
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/metadata should call serveMetadata
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/metadata should call serveMetadata
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/metadata should 400 if missing file
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/metadata should 400 if missing file
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve a file successfully
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[local-server.js] Local media server started on http://localhost:44163

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream should call serveRawStream by default
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream should call serveRawStream by default
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream with transcode=true should call serveTranscodedStream
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream with transcode=true should call serveTranscodedStream
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream should 400 if missing file
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/stream should 400 if missing file
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/thumbnail should call serveThumbnail
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/thumbnail should call serveThumbnail
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/thumbnail should 400 if missing file
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/thumbnail should 400 if missing file
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/serve should call serveRawStream
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/serve should call serveRawStream
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[Security] File existence check failed for /nonexistent-file.txt: Error: ENOENT: no such file or directory, realpath '/nonexistent-file.txt'
[90m    at Object.realpath (node:internal/fs/promises:1172:10)[39m
    at authorizeFilePath [90m(/app/[39msrc/core/security.ts:27:16[90m)[39m
    at LocalMediaSource.ensureAuthorized [90m(/app/[39msrc/core/media-source.ts:20:18[90m)[39m
    at LocalMediaSource.getSize [90m(/app/[39msrc/core/media-source.ts:72:5[90m)[39m
    at serveRawStream [90m(/app/[39msrc/core/media-handler.ts:167:21[90m)[39m
    at serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:381:12[90m)[39m {
  errno: [33m-2[39m,
  code: [32m'ENOENT'[39m,
  syscall: [32m'realpath'[39m,
  path: [32m'/nonexistent-file.txt'[39m
}

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[ServeStatic] Error: Error: Access denied
    at LocalMediaSource.ensureAuthorized [90m(/app/[39msrc/core/media-source.ts:22:13[90m)[39m
    at LocalMediaSource.getSize [90m(/app/[39msrc/core/media-source.ts:72:5[90m)[39m
    at serveRawStream [90m(/app/[39msrc/core/media-handler.ts:167:21[90m)[39m
    at serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:381:12[90m)[39m

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 403 for non-existent file (security)
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould handle range requests
[22m[39m[local-server.js] Local media server started on http://localhost:35985

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/serve should 400 if missing path
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mMedia Handler Routes[2m > [22m[2mGET /api/serve should 400 if missing path
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mGET /auth/google/callback should not expose XSS
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mGET /auth/google/callback should not expose XSS
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould handle range requests
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 416 for invalid range
[22m[39m[local-server.js] Local media server started on http://localhost:42483

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mGET /auth/google/callback should return 400 for invalid code type
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mGET /auth/google/callback should return 400 for invalid code type
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould return 416 for invalid range
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve video files with correct MIME type
[22m[39m[local-server.js] Local media server started on http://localhost:41201

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 200 on success
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 200 on success
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 400 on invalid code
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 400 on invalid code
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 400 on invalid code
[22m[39mError: invalid_grant
    at [90m/app/[39mtests/server/server.test.ts:418:26
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  response: { status: [33m400[39m }
}

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mHTTP Request Handling[2m > [22m[2mshould serve video files with correct MIME type
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[local-server.js] Local media server started on http://localhost:36011

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 500 on other errors
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[Security] Access denied to file outside media directories: /app/tests/forbidden/forbidden-file.txt (resolved from //app/tests/forbidden/forbidden-file.txt)

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 500 on other errors
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[ServeStatic] Error: Error: Access denied
    at LocalMediaSource.ensureAuthorized [90m(/app/[39msrc/core/media-source.ts:22:13[90m)[39m
    at LocalMediaSource.getSize [90m(/app/[39msrc/core/media-source.ts:72:5[90m)[39m
    at serveRawStream [90m(/app/[39msrc/core/media-handler.ts:167:21[90m)[39m
    at serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:381:12[90m)[39m

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 403 for files outside allowed directories
[22m[39m[local-server.js] Local media server stopped.

[90mstderr[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mAuth Routes[2m > [22m[2mPOST /api/auth/google-drive/code should return 500 on other errors
[22m[39mError: Server error
    at [90m/app/[39mtests/server/server.test.ts:434:9
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[local-server.js] Local media server started on http://localhost:41251

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mSecurity Headers[2m > [22m[2mshould set security headers
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mSecurity Headers[2m > [22m[2mshould set security headers
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstderr[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[ServeStatic] Error: Error: Database error
    at [90m/app/[39mtests/main/local-server.test.ts:388:9
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mOther Routes[2m > [22m[2mGET /api/config/extensions should return extensions
[22m[39mInitializing database at /app/media-library.db using worker /app/src/core/database-worker.ts

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mSecurity - Path Validation[2m > [22m[2mshould return 500 when database error occurs during path validation
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/server/server.test.ts[2m > [22m[2mServer[2m > [22m[2mOther Routes[2m > [22m[2mGET /api/config/extensions should return extensions
[22m[39mInitialized DriveCacheManager with cache dir: /app/cache/drive

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mServer Error Handling[2m > [22m[2mshould handle server listen errors gracefully
[22m[39m[local-server.js] Local media server started on http://localhost:12345

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle callback parameter correctly
[22m[39m[local-server.js] Local media server started on http://localhost:33115

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould handle callback parameter correctly
[22m[39m[local-server.js] Local media server stopped.

[90mstdout[2m | tests/main/local-server.test.ts[2m > [22m[2mLocal Server[2m > [22m[2mstopLocalServer[2m > [22m[2mshould log an error if closing fails
[22m[39m[local-server.js] Local media server started on http://localhost:12345

 [32mâœ“[39m tests/server/server.test.ts [2m([22m[2m42 tests[22m[2m)[22m[33m 331[2mms[22m[39m
 [32mâœ“[39m tests/main/local-server.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 244[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumsList.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 275[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrenders initial directory listing
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates into directory on double click
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates into directory on double click
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1/SubFolder'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not navigate on double click if not a directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mselects a directory on click
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2memits select event when clicking Select Directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mclears selection when clicking a file
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2memits cancel event
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates up when up button is clicked
[22m[39m[FileExplorer] loadDirectory mode=local path='/parent/child'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates up when up button is clicked
[22m[39m[FileExplorer] loadDirectory mode=local path='/parent'

[90mstdout[2m | tests/renderer/components/SourcesModal.test.ts[2m > [22m[2mSourcesModal.vue[2m > [22m[2mshould open FileExplorer when add button clicked
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes directory on refresh button click
[22m[39m[FileExplorer] loadDirectory mode=local path='/current'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes directory on refresh button click
[22m[39m[FileExplorer] loadDirectory mode=local path='/current'

[90mstdout[2m | tests/renderer/components/SourcesModal.test.ts[2m > [22m[2mSourcesModal.vue[2m > [22m[2mshould call addMediaDirectory when FileExplorer selects a path
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdisplays error message when listing fails
[22m[39m[FileExplorer] loadDirectory mode=local path='/error'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles empty directory
[22m[39m[FileExplorer] loadDirectory mode=local path='/empty'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2msorts directories first
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mcorrectly identifies drive roots with different cases
[22m[39m[FileExplorer] loadDirectory mode=local path='ROOT'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mcorrectly identifies unix root / as drive
[22m[39m[FileExplorer] loadDirectory mode=local path='ROOT'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mtoggles view mode between list and grid
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive mode initial load
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive mode initial load
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-id'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles Google Drive navigation
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigateUp works correctly in local mode
[22m[39m[FileExplorer] loadDirectory mode=local path='/some/path'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigateUp works correctly in local mode
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/SourcesModal.test.ts[2m > [22m[2mSourcesModal.vue[2m > [22m[2mGoogle Drive Auth[2m > [22m[2msubmits auth code successfully
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mallows selection of directories in Google Drive grid view
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mallows selection of directories in Google Drive grid view
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 2 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not select files in Google Drive grid view
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mdoes not select files in Google Drive grid view
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-abc'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='folder-abc'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes current directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 1 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='sub-folder'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] loadDirectory mode=google-drive path='root'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Google Drive mode
[22m[39m[FileExplorer] listGoogleDriveDirectory returned 0 items

 [32mâœ“[39m tests/renderer/components/SourcesModal.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 194[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Local mode
[22m[39m[FileExplorer] loadDirectory mode=local path='/some/path'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mhandles error when fetching parent directory in Local mode
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes at root (My PC) correctly
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mrefreshes at root (My PC) correctly
[22m[39m[FileExplorer] loadDirectory mode=local path=''

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates on Enter key press
[22m[39m[FileExplorer] loadDirectory mode=local path='/'

[90mstdout[2m | tests/renderer/components/FileExplorer.test.ts[2m > [22m[2mFileExplorer.vue[2m > [22m[2mnavigates on Enter key press
[22m[39m[FileExplorer] loadDirectory mode=local path='/Folder1'

 [32mâœ“[39m tests/renderer/components/FileExplorer.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 220[2mms[22m[39m
[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2minitDatabase[2m > [22m[2mshould initialize the database successfully
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2minitDatabase[2m > [22m[2mshould handle re-initialization
[22m[39m[database.js] Terminating existing database worker before re-init.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2minitDatabase[2m > [22m[2mshould handle re-initialization
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mrecordMediaView[2m > [22m[2mshould record a view for a media file
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mrecordMediaView[2m > [22m[2mshould increment view count on multiple views
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mrecordMediaView[2m > [22m[2mshould handle multiple different files
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetMediaViewCounts[2m > [22m[2mshould return empty object for empty array
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetMediaViewCounts[2m > [22m[2mshould return 0 for files that have not been viewed
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetMediaViewCounts[2m > [22m[2mshould return correct counts for multiple files
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetMediaViewCounts[2m > [22m[2mshould handle files with special characters in paths
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcacheAlbums[2m > [22m[2mshould cache albums successfully
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcacheAlbums[2m > [22m[2mshould overwrite existing cache
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcacheAlbums[2m > [22m[2mshould handle empty albums array
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcacheAlbums[2m > [22m[2mshould preserve album structure
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetCachedAlbums[2m > [22m[2mshould return null when no cache exists
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mgetCachedAlbums[2m > [22m[2mshould retrieve cached albums
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcloseDatabase[2m > [22m[2mshould close database without errors
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcloseDatabase[2m > [22m[2mshould allow re-initialization after closing
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mcloseDatabase[2m > [22m[2mshould allow re-initialization after closing
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mtimeout handling[2m > [22m[2mshould respect custom timeout settings
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling[2m > [22m[2mshould handle multiple sequential operations gracefully
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling[2m > [22m[2mshould handle large batches of view counts
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mmedia directories[2m > [22m[2mshould add and retrieve a media directory
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mmedia directories[2m > [22m[2mshould add and remove a media directory
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2mmedia directories[2m > [22m[2mshould set directory active state
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling for directory operations[2m > [22m[2mshould handle errors when removing non-existent directory
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling for directory operations[2m > [22m[2mshould handle errors when setting active state on non-existent directory
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling for directory operations[2m > [22m[2mshould handle gracefully when trying to record view without initialization
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling for directory operations[2m > [22m[2mshould return empty object when trying to get view counts without initialization
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mDatabase[2m > [22m[2merror handling for directory operations[2m > [22m[2mshould return empty object when trying to get view counts without initialization
[22m[39m[database.js] Error fetching view counts: Error: Database worker not initialized
    at [90m/app/[39msrc/core/database.ts:60:21
    at new Promise (<anonymous>)
    at sendMessageToWorker [90m(/app/[39msrc/core/database.ts:58:10[90m)[39m
    at Module.getMediaViewCounts [90m(/app/[39msrc/core/database.ts:214:18[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:460:31
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mdatabase.js additional coverage - uninitialized[2m > [22m[2mshould reject if dbWorker is not initialized
[22m[39m[database.js] Error adding media directory '/test/path': Error: Database worker not initialized
    at [90m/app/[39msrc/core/database.ts:60:21
    at new Promise (<anonymous>)
    at sendMessageToWorker [90m(/app/[39msrc/core/database.ts:58:10[90m)[39m
    at Module.addMediaDirectory [90m(/app/[39msrc/core/database.ts:316:11[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:480:26
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'setRating' errors
[22m[39m[database.js] Error setting rating: Error: Rating error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:541:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'setRating' errors
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'upsertMetadata' errors
[22m[39m[database.js] Error upserting metadata: Error: Metadata error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:541:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'upsertMetadata' errors
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'createSmartPlaylist' errors
[22m[39m[database.js] Error creating smart playlist: Error: Create playlist error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:541:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'createSmartPlaylist' errors
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'updateSmartPlaylist' errors
[22m[39m[database.js] Error updating smart playlist: Error: Update playlist error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:541:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'updateSmartPlaylist' errors
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'deleteSmartPlaylist' errors
[22m[39m[database.js] Error deleting smart playlist: Error: Delete playlist error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:541:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle 'deleteSmartPlaylist' errors
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty array on getSmartPlaylists error
[22m[39m[database.js] Error getting smart playlists: Error: Get playlists error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:561:31
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty array on getSmartPlaylists error
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty array on getAllMetadataAndStats error
[22m[39m[database.js] Error getting all metadata: Error: Get metadata error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:581:31
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty array on getAllMetadataAndStats error
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty object on getMetadata error
[22m[39m[database.js] Error getting metadata: Error: Get metadata error
    at MockWorker.<anonymous> [90m(/app/[39msrc/core/database.ts:133:28[90m)[39m
[90m    at MockWorker.emit (node:events:519:28)[39m
    at MockWorker.simulateMessage [90m(/app/[39mtests/main/database.test.ts:115:10[90m)[39m
    at [90m/app/[39mtests/main/database.test.ts:601:31
[90m    at processTicksAndRejections (node:internal/process/task_queues:85:11)[39m

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould return empty object on getMetadata error
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mlogs an error when worker exits unexpectedly
[22m[39m[database.js] Attempting to restart worker in 1s...

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mlogs an error when worker exits unexpectedly
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mlogs a warning for recordMediaView errors in non-test environment
[22m[39m[database.js] Error posting message to worker: Test worker error

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mlogs a warning for recordMediaView errors in non-test environment
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mrejects pending messages when worker emits an error
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mgetMediaDirectories should return [] on falsy worker response
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle errors when terminating the worker during close
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mshould handle errors when terminating the worker during close
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2msendMessageToWorker handles synchronous postMessage error
[22m[39m[database.js] Database worker terminated.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2msendMessageToWorker handles synchronous postMessage error
[22m[39m[database.js] Error posting message to worker: Sync postMessage error

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2msendMessageToWorker handles synchronous postMessage error
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mcloseDatabase logs warning if close message fails in non-test env
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mcloseDatabase logs warning if close message fails in non-test env
[22m[39m[database.js] Database worker initialized successfully.

[90mstderr[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mcloseDatabase logs warning if close message fails in non-test env
[22m[39m[database.js] Error posting message to worker: Close message failed

[90mstdout[2m | tests/main/database.test.ts[2m > [22m[2mAdditional Function Coverage[2m > [22m[2mcloseDatabase logs warning if close message fails in non-test env
[22m[39m[database.js] Database worker terminated.

 [32mâœ“[39m tests/main/database.test.ts [2m([22m[2m43 tests[22m[2m)[22m[32m 194[2mms[22m[39m
[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2minitDatabase handles worker error event
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2msendMessageToWorker handles timeout
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2msendMessageToWorker handles worker postMessage exception
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2maddMediaDirectory handles object payload
[22m[39m[database.js] Database worker terminated.

[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2mhandles worker exit with error code
[22m[39m[database.js] Attempting to restart worker in 1s...

[90mstdout[2m | tests/core/database.coverage.test.ts[2m > [22m[2mDatabase Core Coverage[2m > [22m[2mhandles worker exit with error code
[22m[39m[database.js] Database worker terminated.

 [32mâœ“[39m tests/core/database.coverage.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 186[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/Palette.a11y.test.ts[2m > [22m[2mPalette Accessibility Improvements[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mshould handle keyboard navigation on progress bar in transcoding mode
[22m[39mTranscoding URL: ?transcode=true

[90mstdout[2m | tests/renderer/components/Palette.a11y.test.ts[2m > [22m[2mPalette Accessibility Improvements[2m > [22m[2mMediaDisplay.vue[2m > [22m[2mshould handle keyboard navigation on progress bar in transcoding mode
[22m[39mTranscoding URL: ?transcode=true

 [32mâœ“[39m tests/renderer/components/Palette.a11y.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 191[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/MediaDisplayVlc.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 116[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/App.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 144[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/MediaDisplay.concurrency.test.ts[2m > [22m[2mMediaDisplay Race Condition[2m > [22m[2mcorrectly handles overlapping states: Transcoding text replaces Loading text
[22m[39mProactively transcoding legacy format: legacy.mkv
Proactively transcoding legacy format: legacy.mkv

[90mstdout[2m | tests/renderer/components/MediaDisplay.concurrency.test.ts[2m > [22m[2mMediaDisplay Race Condition[2m > [22m[2mcorrectly handles overlapping states: Transcoding text replaces Loading text
[22m[39mTranscoding URL: http://localhost/stream/%2Fpath%2Fto%2Flegacy.mkv?transcode=true

[90mstdout[2m | tests/renderer/components/MediaDisplay.concurrency.test.ts[2m > [22m[2mMediaDisplay Race Condition[2m > [22m[2mcorrectly handles overlapping states: Transcoding text replaces Loading text
[22m[39mTranscoding URL: http://localhost/stream/%2Fpath%2Fto%2Flegacy.mkv?transcode=true

 [32mâœ“[39m tests/renderer/components/MediaDisplay.concurrency.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 79[2mms[22m[39m
 [32mâœ“[39m tests/renderer/google-drive.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 199[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumTree.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 287[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/App.branch.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 194[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/AlbumsList.coverage.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 117[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/SmartPlaylistModal.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 96[2mms[22m[39m
[90mstdout[2m | tests/renderer/components/MediaDisplay.coverage.test.ts[2m > [22m[2mMediaDisplay.vue Additional Coverage[2m > [22m[2mshould handle metadata loading failure during transcoding (swallow error)
[22m[39mTranscoding URL: stream//test.mp4?transcode=true

[90mstderr[2m | tests/renderer/components/MediaDisplay.coverage.test.ts[2m > [22m[2mMediaDisplay.vue Additional Coverage[2m > [22m[2mshould handle missing video stream generator
[22m[39mFailed to initialize video stream generator Error: Init fail
    at [90m/app/[39mtests/renderer/components/MediaDisplay.coverage.test.ts:99:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.coverage.test.ts[2m > [22m[2mMediaDisplay.vue Additional Coverage[2m > [22m[2mshould handle missing video stream generator
[22m[39mFailed to initialize video stream generator Error: Init fail
    at [90m/app/[39mtests/renderer/components/MediaDisplay.coverage.test.ts:99:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/renderer/components/MediaDisplay.coverage.test.ts[2m > [22m[2mMediaDisplay.vue Additional Coverage[2m > [22m[2mshould handle missing video stream generator
[22m[39mTranscoding failed Error: Init fail
    at [90m/app/[39mtests/renderer/components/MediaDisplay.coverage.test.ts:99:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/renderer/components/MediaDisplay.coverage.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 111[2mms[22m[39m
[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath returns existing cache
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles metadata fetch error
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles metadata fetch error
[22m[39m[DriveCache] Failed to fetch metadata: Error: Meta Fail
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:81:7
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mreuses cached metadata on subsequent calls
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath resumes partial download
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath downloads file on cache miss
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles download error (start fail)
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mgetCachedFilePath handles download error (start fail)
[22m[39m[DriveCache] Failed to start download: Error: Download Fail
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:185:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mhandles stream error properly
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mhandles stream error properly
[22m[39m[DriveCache] Drive Stream error for stream-error-file: Error: Stream Dies
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:223:36
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mactive download handles concurrent requests
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup deletes files
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup deletes files
[22m[39m[DriveCache] Cache cleared.

[90mstdout[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanup handles error
[22m[39m[DriveCache] Cache cleared.

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mthrows when getting manager before initialization
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:266:13[90m)[39m
    at Object.rmSync [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:158:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:186:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:42:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at runHook [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1514:51[90m)[39m

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mthrows when getting manager before initialization
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:266:13[90m)[39m
    at Object.rmSync [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:158:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:186:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:308:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m

[90mstderr[2m | tests/main/drive-cache-manager.test.ts[2m > [22m[2mDriveCacheManager[2m > [22m[2mcleanupDriveCacheManager is safe when no instance exists
[22m[39m[DriveCache] Cleanup failed: Error: Delete fail
    at Object.<anonymous> [90m(/app/[39mtests/main/drive-cache-manager.test.ts:266:13[90m)[39m
    at Object.rmSync [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at DriveCacheManager.cleanup [90m(/app/[39msrc/main/drive-cache-manager.ts:158:10[90m)[39m
    at Module.cleanupDriveCacheManager [90m(/app/[39msrc/main/drive-cache-manager.ts:186:29[90m)[39m
    at [90m/app/[39mtests/main/drive-cache-manager.test.ts:315:5
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m

 [32mâœ“[39m tests/main/drive-cache-manager.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 78[2mms[22m[39m
[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return all media when filter is "All"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return only videos when filter is "Videos"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return only images when filter is "Images"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mfilterMedia[2m > [22m[2mshould return all media if filter is not "Videos" or "Images"
[22m[39mSkipping media item with invalid or missing path: { name: [32m'invalid'[39m, path: [32m''[39m }
Skipping media item with invalid or missing path: { path: [32m''[39m, name: [32m'invalid'[39m }

[90mstderr[2m | tests/renderer/composables/useSlideshow.test.ts[2m > [22m[2museSlideshow[2m > [22m[2mstartSlideshow[2m > [22m[2mshould handle when no albums are selected
[22m[39mNo albums selected for slideshow.

 [32mâœ“[39m tests/renderer/components/ProgressBars.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 69[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useSlideshow.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 43[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if gdrive duration missing
[22m[39m[MediaController] Error getting video metadata: Error: Duration not available
    at [90m/app/[39msrc/main/ipc/media-controller.ts:74:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if getVideoDuration returns error
[22m[39m[MediaController] Error getting video metadata: Error: Fail
    at [90m/app/[39msrc/main/ipc/media-controller.ts:85:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/main/ipc/media-controller.test.ts:185:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/ipc/media-controller.test.ts[2m > [22m[2mmedia-controller[2m > [22m[2mDRIVE_GET_PARENT[2m > [22m[2mreturns null on error
[22m[39mFailed to get drive parent Error: Fail
    at [90m/app/[39mtests/main/ipc/media-controller.test.ts:259:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/main/ipc/media-controller.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 42[2mms[22m[39m
[90mstderr[2m | tests/main/database.error.test.ts[2m > [22m[2mDatabase error handling (isolated)[2m > [22m[2mrecordMediaView/getMediaViewCounts should handle postMessage failures gracefully
[22m[39m[database.js] Error posting message to worker: postMessage failed

[90mstderr[2m | tests/main/database.error.test.ts[2m > [22m[2mDatabase error handling (isolated)[2m > [22m[2mrecordMediaView/getMediaViewCounts should handle postMessage failures gracefully
[22m[39m[database.js] Error posting message to worker: postMessage failed

[90mstderr[2m | tests/main/database.error.test.ts[2m > [22m[2mDatabase error handling (isolated)[2m > [22m[2mrecordMediaView/getMediaViewCounts should handle postMessage failures gracefully
[22m[39m[database.js] Error fetching view counts: Error: postMessage failed
    at MockWorker.postMessage [90m(/app/[39mtests/main/database.error.test.ts:59:17[90m)[39m
    at [90m/app/[39msrc/core/database.ts:79:16
    at new Promise (<anonymous>)
    at sendMessageToWorker [90m(/app/[39msrc/core/database.ts:58:10[90m)[39m
    at Module.getMediaViewCounts [90m(/app/[39msrc/core/database.ts:214:18[90m)[39m
    at [90m/app/[39mtests/main/database.error.test.ts:82:29
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/main/database.error.test.ts[2m > [22m[2mDatabase error handling (isolated)[2m > [22m[2mrecordMediaView/getMediaViewCounts should handle postMessage failures gracefully
[22m[39m[database.js] Error posting message to worker: postMessage failed

[90mstdout[2m | tests/main/database.error.test.ts[2m > [22m[2mDatabase error handling (isolated)[2m > [22m[2mrecordMediaView/getMediaViewCounts should handle postMessage failures gracefully
[22m[39m[database.js] Database worker terminated.

 [32mâœ“[39m tests/main/database.error.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 40[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/LoadingMask.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 29[2mms[22m[39m
 [32mâœ“[39m tests/main/google-auth.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 29[2mms[22m[39m
 [32mâœ“[39m tests/core/file-system.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 26[2mms[22m[39m
 [32mâœ“[39m tests/renderer/api/ElectronAdapter.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[local-server.js] Local media server started on http://localhost:42515

[90mstderr[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[database.js] Error getting media directories: Error: Database worker not initialized
    at [90m/app/[39msrc/core/database.ts:60:21
    at new Promise (<anonymous>)
    at sendMessageToWorker [90m(/app/[39msrc/core/database.ts:58:10[90m)[39m
    at getMediaDirectories [90m(/app/[39msrc/core/database.ts:334:31[90m)[39m
    at authorizeFilePath [90m(/app/[39msrc/core/security.ts:23:34[90m)[39m
    at serveMetadata [90m(/app/[39msrc/core/media-handler.ts:134:26[90m)[39m
    at Server.<anonymous> [90m(/app/[39msrc/core/media-handler.ts:421:14[90m)[39m
[90m    at Server.emit (node:events:519:28)[39m
[90m    at parserOnIncoming (node:_http_server:1186:12)[39m
[90m    at HTTPParser.parserOnHeadersComplete (node:_http_common:122:17)[39m

[90mstderr[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[Security] File existence check failed for /tmp/testNaNile.mp4:

[90mstdout[2m | tests/main/local-server.encoding.test.ts[2m > [22m[2mLocal Server Encoding Bug[2m > [22m[2mshould handle file paths with percent characters without crashing
[22m[39m[local-server.js] Local media server stopped.

 [32mâœ“[39m tests/main/local-server.encoding.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 57[2mms[22m[39m
 [32mâœ“[39m tests/main/database-paths.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 37[2mms[22m[39m
[90mstderr[2m | tests/core/media-source.test.ts[2m > [22m[2mmedia-source[2m > [22m[2mDriveMediaSource[2m > [22m[2mgetFFmpegInput handles metadata error gracefully
[22m[39mFailed to resolve extension for Drive file input Error: Fetch failed
    at [90m/app/[39mtests/core/media-source.test.ts:163:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-source.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mstart()[2m > [22m[2mstarts server and resolves
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mgetUrlForFile starts server if needed and returns url
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mRequest Handling[2m > [22m[2mhandles request processing error
[22m[39m[InternalProxy] Request Error: Error: API Fail
    at [90m/app/[39mtests/core/media-proxy.test.ts:134:50
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/drive-stream.test.ts[2m > [22m[2mdrive-stream unit tests[2m > [22m[2mfalls back to drive metadata and stream on cache error
[22m[39mDrive Cache/Fetch failed Error: Cache missing
    at [90m/app/[39mtests/core/drive-stream.test.ts:130:45
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/drive-stream.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mRequest Handling[2m > [22m[2mhandles stream errors
[22m[39m[InternalProxy] Stream Error: Error: Stream failed
    at [90m/app/[39mtests/core/media-proxy.test.ts:293:23
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mgetUrlForFile returns cached port if listening
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstdout[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mstart() is idempotent
[22m[39m[InternalMediaProxy] Started on port 54321

[90mstderr[2m | tests/core/media-proxy.test.ts[2m > [22m[2mInternalMediaProxy[2m > [22m[2mdoes not send error response if headers already sent
[22m[39m[InternalProxy] Request Error: Error: Fail after headers
    at [90m/app/[39mtests/core/media-proxy.test.ts:355:48
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/core/media-proxy.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/auth-controller.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mâœ“[39m tests/renderer/api/index.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/media-controller.ffmpeg.test.ts[2m > [22m[2mmedia-controller (ffmpeg missing)[2m > [22m[2mGET_VIDEO_METADATA[2m > [22m[2mthrows if ffmpeg missing for local file
[22m[39m[MediaController] Error getting video metadata: Error: FFmpeg binary not found
    at [90m/app/[39msrc/main/ipc/media-controller.ts:81:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/app/[39mtests/main/ipc/media-controller.ffmpeg.test.ts:61:7
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m tests/main/ipc/media-controller.ffmpeg.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/core/providers/drive-provider.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mâœ“[39m tests/renderer/api/WebAdapter.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mstarts the server on the specified port
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mdoes not restart if already running
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mdoes not restart if already running
[22m[39m[AuthServer] Server already running.

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles /auth/google/callback route
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles /auth/google/callback route without code
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mreturns 404 for other routes
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mstops the server
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles server error event
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstderr[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles server error event
[22m[39m[AuthServer] Error: Error: EADDRINUSE
    at [90m/app/[39mtests/main/auth-server.test.ts:197:21
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mescapes HTML in the code parameter
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

[90mstdout[2m | tests/main/auth-server.test.ts[2m > [22m[2mAuth Server[2m > [22m[2mhandles request with undefined url
[22m[39m[AuthServer] Listening on port 3000 for OAuth callback

 [32mâœ“[39m tests/main/auth-server.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstderr[2m | tests/main/ipc/system-controller.test.ts[2m > [22m[2msystem-controller[2m > [22m[2mADD_MEDIA_DIRECTORY[2m > [22m[2mreturns null if addMediaDirectory fails
[22m[39mFailed to add directory by path Error: DB Error
    at [90m/app/[39mtests/main/ipc/system-controller.test.ts:92:53
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/main/ipc/system-controller.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/renderer/components/icons/VlcIcon.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mâœ“[39m tests/main/media-scanner.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useAppState.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m tests/renderer/utils/albumUtils.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstderr[2m | tests/core/media-handler.security.test.ts[2m > [22m[2mmedia-handler security[2m > [22m[2mprevents file enumeration in serveStaticFile via handler
[22m[39m[ServeStatic] Error: Error: Access denied: File is not in a configured media directory.
    at [90m/app/[39mtests/core/media-handler.security.test.ts:64:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:380:20[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:488:12
    at [90m/app/[39mtests/core/media-handler.security.test.ts:71:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m

[90mstderr[2m | tests/core/media-handler.security.test.ts[2m > [22m[2mmedia-handler security[2m > [22m[2mprevents file enumeration in serveStaticFile via handler
[22m[39m[ServeStatic] Error: Error: Access denied: File does not exist.
    at [90m/app/[39mtests/core/media-handler.security.test.ts:81:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at serveStaticFile [90m(/app/[39msrc/core/media-handler.ts:380:20[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:488:12
    at [90m/app/[39mtests/core/media-handler.security.test.ts:84:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20

[90mstderr[2m | tests/core/media-handler.security.test.ts[2m > [22m[2mmedia-handler security[2m > [22m[2mprevents file enumeration in serveTranscodedStream (video/stream)
[22m[39m[Handler] Stream failed: Error: Access denied.
    at [90m/app/[39mtests/core/media-handler.security.test.ts:106:13
    at Mock [90m(file:///app/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at [90m/app/[39msrc/core/media-handler.ts:437:24
    at [90m/app/[39mtests/core/media-handler.security.test.ts:109:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37

 [32mâœ“[39m tests/core/media-handler.security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 24[2mms[22m[39m
 [32mâœ“[39m tests/main/ipc/database-controller.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/core/providers/local-provider.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/main/media-service.coverage.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/core/media-service.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/main/media-scanner.errors.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstderr[2m | tests/core/security.test.ts[2m > [22m[2mauthorizeFilePath Security[2m > [22m[2mprevents file enumeration: returns uniform error message
[22m[39m[Security] File existence check failed for /missing: Error: ENOENT
    at [90m/app/[39mtests/core/security.test.ts:31:46
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///app/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///app/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

[90mstderr[2m | tests/core/security.test.ts[2m > [22m[2mauthorizeFilePath Security[2m > [22m[2mprevents file enumeration: returns uniform error message
[22m[39m[Security] Access denied to file outside media directories: /secret/passwd (resolved from /secret/passwd)

 [32mâœ“[39m tests/core/security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/main/database.env.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m tests/main/google-secrets.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/main/constants.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mperformFullMediaScan logs error in non-test env
[22m[39m[media-scanner.js] Starting disk scan in directories: [ [32m'/bad/dir'[39m ]

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mperformFullMediaScan logs error in non-test env
[22m[39m[media-scanner.js] Found 0 root albums during scan.

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mscanDirectoryRecursive logs error in non-test env
[22m[39m[media-scanner.js] Starting disk scan in directories: [ [32m'/base'[39m ]

[90mstdout[2m | tests/main/media-scanner.coverage.test.ts[2m > [22m[2mmedia-scanner coverage[2m > [22m[2mscanDirectoryRecursive logs error in non-test env
[22m[39m[media-scanner.js] Found 0 root albums during scan.

 [32mâœ“[39m tests/main/media-scanner.coverage.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m tests/renderer/composables/useSlideshow.coverage.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m

[2m Test Files [22m [1m[32m72 passed[39m[22m[90m (72)[39m
[2m      Tests [22m [1m[32m910 passed[39m[22m[90m (910)[39m
[2m   Start at [22m 20:35:01
[2m   Duration [22m 38.63s[2m (transform 11.93s, setup 0ms, import 30.14s, tests 39.62s, environment 27.41s)[22m

[34m % [39m[2mCoverage report from [22m[33mistanbul[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-------------------|---------|----------|---------|---------|-------------------
All files          |   92.88 |    86.36 |   94.16 |   93.57 |
 core              |   91.25 |    84.63 |   93.58 |   91.28 |
  constants.ts     |     100 |      100 |     100 |     100 |
  ...ase-worker.ts |   86.06 |    84.95 |   96.77 |   85.22 | ...85-689,766-774
  database.ts      |   88.35 |    84.61 |   89.28 |   88.35 | ...79-383,544-548
  drive-stream.ts  |     100 |      100 |     100 |     100 |
  file-system.ts   |   96.55 |    91.66 |     100 |   96.15 | 45
  ...er-factory.ts |      80 |      100 |     100 |      80 | 16
  media-handler.ts |   95.58 |     80.5 |   92.59 |   95.49 | ...46-347,485,593
  media-proxy.ts   |     100 |     87.5 |     100 |     100 | 17,45-70
  media-scanner.ts |   90.47 |    84.37 |      90 |   93.44 | 27,35-36,172
  media-service.ts |   81.66 |       80 |   83.33 |   81.81 | 46-66,157,162
  media-source.ts  |     100 |     87.5 |     100 |     100 | 49-91,114
  media-utils.ts   |   94.44 |    94.73 |     100 |   94.44 | 34,48
  security.ts      |   94.73 |     87.5 |     100 |   94.11 | 20
 core/providers    |     100 |      100 |     100 |     100 |
  ...e-provider.ts |     100 |      100 |     100 |     100 |
  ...l-provider.ts |     100 |      100 |     100 |     100 |
 main              |   98.05 |    87.29 |   96.61 |   98.03 |
  auth-server.ts   |     100 |     90.9 |     100 |     100 | 5
  database.ts      |     100 |      100 |     100 |     100 |
  ...he-manager.ts |   91.78 |    91.66 |   85.71 |   91.78 | 68,96,135-137,179
  google-auth.ts   |     100 |     90.9 |     100 |     100 | 34,56
  ...ve-service.ts |     100 |    84.52 |     100 |     100 | ...11,254-266,338
  ...le-secrets.ts |     100 |      100 |     100 |     100 |
  local-server.ts  |     100 |    82.14 |     100 |     100 | 45-62,92
 main/ipc          |   97.61 |    87.87 |    97.5 |   98.36 |
  ...controller.ts |     100 |      100 |     100 |     100 |
  ...controller.ts |   94.73 |      100 |    90.9 |   94.73 | 41
  ...controller.ts |      98 |    82.35 |     100 |   97.95 | 27
  ...controller.ts |   97.72 |    92.85 |     100 |     100 | 79
 main/utils        |     100 |    86.66 |     100 |     100 |
  ipc-helper.ts    |     100 |       80 |     100 |     100 | 27
  ...rity-utils.ts |     100 |       90 |     100 |     100 | 11
 renderer          |     100 |      100 |     100 |     100 |
  App.vue          |     100 |      100 |     100 |     100 |
 renderer/api      |   95.52 |    88.09 |     100 |   95.48 |
  ...ronAdapter.ts |     100 |      100 |     100 |     100 |
  WebAdapter.ts    |    92.4 |    82.14 |     100 |    92.3 | ...12,237-238,310
  index.ts         |     100 |      100 |     100 |     100 |
 ...rer/components |   92.68 |    87.62 |   89.24 |    94.6 |
  AlbumTree.vue    |   91.42 |      100 |      80 |   91.17 | 91,115-116
  AlbumsList.vue   |    86.6 |    88.23 |      80 |   86.79 | ...58,365-380,402
  ...ackground.vue |   92.59 |    82.85 |     100 |     100 | 39,62-77,88
  FileExplorer.vue |   97.11 |    94.44 |   84.21 |   97.02 | 94-96
  LoadingMask.vue  |     100 |      100 |     100 |     100 |
  MediaDisplay.vue |   89.61 |    81.05 |   86.66 |   93.33 | ...31-835,844-845
  MediaGrid.vue    |    97.5 |    83.33 |     100 |     100 | 63-67,140-158,175
  ...listModal.vue |     100 |      100 |     100 |     100 |
  SourcesModal.vue |   95.12 |    89.83 |   95.45 |   95.04 | ...96,376-377,387
 ...er/composables |   90.63 |    81.57 |   96.87 |   91.85 |
  useAppState.ts   |     100 |      100 |     100 |     100 |
  useSlideshow.ts  |   87.91 |    80.18 |   94.73 |   89.41 | ...20,310,364-368
 renderer/utils    |     100 |    94.44 |     100 |     100 |
  albumUtils.ts    |     100 |    94.44 |     100 |     100 | 36
 server            |   88.88 |    81.73 |    90.9 |   89.01 |
  server.ts        |   88.88 |    81.73 |    90.9 |   89.01 | ...77,582-585,596
-------------------|---------|----------|---------|---------|-------------------
